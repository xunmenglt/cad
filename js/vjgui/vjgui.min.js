var vjgui={root:null,content:null,panels:{},windows:[],undo_steps:[],modalbg_div:null,mainmenu:null,init:function(e){e=e||{};if(e.width&&e.height)this.setWindowSize(e.width,e.height);this.container=null;if(e.container)this.container=document.getElementById(e.container);if(!this.container)this.container=document.body;if(e.wrapped){var t=document.createElement("div");t.style.position="relative";t.style.overflow="hidden";this.root=t;this.container.appendChild(t);var i=document.createElement("div");this.content=i;this.root.appendChild(i);if(this.root.classList.contains("fullscreen")){window.addEventListener("resize",function(e){vjgui.maximizeWindow()})}}else this.root=this.content=this.container;this.root.className="vjgui-wrap fullscreen";this.content.className="vjgui-maincontent";var n=this.modalbg_div=document.createElement("div");this.modalbg_div.className="vjmodalbg";this.root.appendChild(this.modalbg_div);n.style.display="none";if(e.menubar)this.createMenubar();if(e.gui_callback)e.gui_callback();window.addEventListener("beforeunload",function(e){for(var t in vjgui.windows)vjgui.windows[t].close();vjgui.windows=[]})},trigger:function(e,t,i,n){var r=document.createEvent("CustomEvent");r.initCustomEvent(t,true,true,i);r.srcElement=n;if(e.dispatchEvent)e.dispatchEvent(r);else if(e.__events)e.__events.dispatchEvent(r);return r},bind:function(e,t,i){if(!e)throw"Cannot bind to null";if(!t)throw"Event bind missing";if(!i)throw"Bind callback missing";if(e.constructor===String)e=document.querySelectorAll(e);if(e.constructor===NodeList||e.constructor===Array){for(var n=0;n<e.length;++n)r(e[n])}else r(e);function r(e){if(e.addEventListener)e.addEventListener(t,i);else if(e.__events)e.__events.addEventListener(t,i);else{var n=document.createElement("span");n.widget=e;Object.defineProperty(e,"__events",{enumerable:false,configurable:false,writable:false,value:n});e.__events.addEventListener(t,i)}}},unbind:function(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i);else if(e.__events&&e.__events.removeEventListener)e.__events.removeEventListener(t,i)},removeClass:function(e,t,i){if(!i){i=t;t="."+t}var n=(e||document).querySelectorAll(t);for(var r=0;r<n.length;++r)n[r].classList.remove(i)},add:function(e){this.content.appendChild(e.root||e)},remove:function(e){if(!e)return;if(e.constructor===String){var t=document.querySelectorAll(e);for(var i=0;i<t.length;++i){var e=t[i];if(e&&e.parentNode)e.parentNode.removeChild(e)}}if(e.constructor===Array||e.constructor===NodeList){for(var i=0;i<e.length;++i)vjgui.remove(e[i])}else if(e.root&&e.root.parentNode)e.root.parentNode.removeChild(e.root);else if(e.parentNode)e.parentNode.removeChild(e)},getById:function(e){return document.getElementById(e)},createMenubar:function(){this.menubar=new vjgui.Menubar("mainmenubar");this.add(this.menubar)},setWindowSize:function(e,t){var i=this.root.style;if(e&&t){i.width=e+"px";i.height=t+"px";i.boxShadow="0 0 4px black";this.root.classList.remove("fullscreen")}else{if(this.root.classList.contains("fullscreen"))return;this.root.classList.add("fullscreen");i.width="100%";i.height="100%";i.boxShadow="0 0 0"}vjgui.trigger(vjgui,"resized")},maximizeWindow:function(){this.setWindowSize()},setCursor:function(e){this.root.style.cursor=e},isCursorOverElement:function(e,t){var i=e.pageX;var n=e.pageY;var r=t.getBoundingClientRect();if(!r)return false;if(n>r.top&&n<r.top+r.height&&i>r.left&&i<r.left+r.width)return true;return false},getRect:function(e){return e.getBoundingClientRect()},toClipboard:function(e,t){if(e&&e.constructor!==String)e=JSON.stringify(e);var i=null;var n=false;if(!t)try{var r=document.queryCommandSupported("copy");i=document.createElement("input");i.type="text";i.style.opacity=0;i.value=e;document.body.appendChild(i);i.select();n=document.execCommand("copy");console.log(n?"saved to clipboard":"problem saving to clipboard");document.body.removeChild(i)}catch(e){if(i)document.body.removeChild(i);console.warn("Oops, unable to copy using the true clipboard")}try{this._safe_cliboard=null;localStorage.setItem("vjgui_clipboard",e)}catch(t){this._safe_cliboard=e;console.warn("cliboard quota excedeed")}},getLocalClipboard:function(){var e=localStorage.getItem("vjgui_clipboard");if(!e&&this._safe_cliboard)e=this._safe_cliboard;if(!e)return null;if(e[0]=="{")return JSON.parse(e);return e},addCSS:function(e){if(!e)return;if(e.constructor===String){var t=document.createElement("style");t.type="text/css";t.innerHTML=e;document.getElementsByTagName("head")[0].appendChild(t);return}else{for(var i in e)document.body.style[i]=e[i]}},requireCSS:function(e,t){if(typeof e=="string")e=[e];while(e.length){var i=document.createElement("link");i.rel="stylesheet";i.type="text/css";i.href=e.shift(1);i.media="all";var n=document.getElementsByTagName("head")[0];n.appendChild(i);if(e.length==0)i.onload=t}},request:function(e){var t=e.dataType||"text";if(t=="json")t="text";else if(t=="xml")t="text";else if(t=="binary"){t="arraybuffer";e.mimeType="application/octet-stream"}var i=new XMLHttpRequest;i.open(e.data?"POST":"GET",e.url,true);if(t)i.responseType=t;if(e.mimeType)i.overrideMimeType(e.mimeType);if(e.nocache)i.setRequestHeader("Cache-Control","no-cache");i.onload=function(t){var n=this.response;if(this.status!=200){var r="Error "+this.status;if(e.error)e.error(r);LEvent.trigger(i,"fail",this.status);return}if(e.dataType=="json"){try{n=JSON.parse(n)}catch(r){if(e.error)e.error(r);else throw r}}else if(e.dataType=="xml"){try{var o=new DOMParser;n=o.parseFromString(n,"text/xml")}catch(r){if(e.error)e.error(r);else throw r}}if(e.success)e.success.call(this,n,this)};i.onerror=function(t){if(e.error)e.error(t)};var n=new FormData;if(e.data){for(var r in e.data)n.append(r,e.data[r])}i.send(n);return i},requestText:function(e,t,i){return this.request({url:e,dataType:"text",success:t,error:i})},requestJSON:function(e,t,i){return this.request({url:e,dataType:"json",success:t,error:i})},requestBinary:function(e,t,i){return this.request({url:e,dataType:"binary",success:t,error:i})},requireScript:function(e,t,i,n,r){if(!e)throw"invalid URL";if(e.constructor===String)e=[e];var o=e.length;var s=o;var a=[];for(var l in e){var c=document.createElement("script");c.num=l;c.type="text/javascript";c.src=e[l]+(r?"?version="+r:"");c.original_src=e[l];c.async=false;c.onload=function(e){o--;a.push(this);if(o){if(n)n(this.original_src,this.num)}else if(t)t(a)};if(i)c.onerror=function(e){i(e,this.original_src,this.num)};document.getElementsByTagName("head")[0].appendChild(c)}},requireScriptSerial:function(e,t,i){if(typeof e=="string")e=[e];var n=[];function r(){var o=document.createElement("script");o.type="text/javascript";o.src=e.shift(1);o.onload=function(o){if(e.length){if(i)i(e[0],e.length);r();return}n.push(this);if(t)t(n)};document.getElementsByTagName("head")[0].appendChild(o)}r()},newDiv:function(e,t){return this.createElement("div",e,t)},createElement:function(e,t,i,n,r){var o=document.createElement(e);if(t){var s=t.split(" ");for(var a=0;a<s.length;a++){if(s[a][0]==".")o.classList.add(s[a].substr(1));else if(s[a][0]=="#")o.id=s[a].substr(1);else o.id=s[a]}}o.root=o;if(i)o.innerHTML=i;o.add=function(e){this.appendChild(e.root||e)};if(n){if(n.constructor===String)o.setAttribute("style",n);else for(var a in n)o.style[a]=n[a]}if(r){for(var a in r)o.addEventListener(a,r[a])}return o},createListItem:function(e,t,i){var n=document.createElement("span");n.innerHTML=e;n=n.childNodes[0];if(t)for(var r in t){var o=n.querySelector(r);if(o)o.innerText=t[r]}if(i)for(var r in i)n.style[r]=i[r];return n},createButton:function(e,t,i,n){var r=document.createElement("button");r.className="vjgui vjbutton button";if(e){var o=e.split(" ");for(var s=0;s<o.length;s++){if(o[s][0]==".")r.classList.add(o[s].substr(1));else if(o[s][0]=="#")r.id=o[s].substr(1);else r.id=o[s]}}r.root=r;if(t!==undefined)r.innerHTML=t;if(i)r.addEventListener("click",i);if(n){if(n.constructor===String)r.setAttribute("style",n);else for(var s in n)r.style[s]=n[s]}return r},getParents:function(e){var t=[];while((e=e.parentElement)!==null){if(e.nodeType!==Node.ELEMENT_NODE)continue;t.push(elem)}return t},newWindow:function(e,t,i,n){n=n||{};var r=window.open("","","width="+t+", height="+i+", location=no, status=no, menubar=no, titlebar=no, fullscreen=yes");r.document.write("<html><head><title>"+e+"</title>");var o=document.querySelectorAll("link[rel='stylesheet'],style");for(var s=0;s<o.length;s++)r.document.write(o[s].outerHTML);if(n.scripts){var a=document.querySelectorAll("script");for(var s=0;s<a.length;s++){if(a[s].src)r.document.write(a[s].outerHTML)}}var l=n.content||"";r.document.write("</head><body>"+l+"</body></html>");r.document.close();return r},showModalBackground:function(e){if(vjgui.modalbg_div)vjgui.modalbg_div.style.display=e?"block":"none"},showMessage:function(e,t){t=t||{};t.title=t.title||"Attention";t.content=e;t.close="fade";var i=new vjgui.Dialog(t);if(!t.noclose)i.addButton("Close",{close:true});i.makeModal("fade");return i},popup:function(e,t){t=t||{};t.min_height=140;if(typeof e=="string")e="<p>"+e+"</p>";t.content=e;t.close="fade";var i=new vjgui.Dialog(t);if(!t.noclose)i.addButton("Close",{close:true});i.show();return i},alert:function(e,t){t=t||{};t.className="alert";t.title=t.title||"Alert";t.width=t.width||280;t.height=t.height||140;if(typeof e=="string")e="<p>"+e+"</p>";vjgui.remove(".vjpanel.alert");return vjgui.showMessage(e,t)},confirm:function(e,t,i){i=i||{};i.className="alert";i.title=i.title||"Confirm";i.width=i.width||280;if(typeof e=="string")e="<p>"+e+"</p>";e+="<button class='vjbutton' data-value='yes' style='width:45%; margin-left: 10px'>Yes</button><button class='vjbutton' data-value='no' style='width:45%'>No</button>";i.noclose=true;var n=this.showMessage(e,i);n.content.style.paddingBottom="10px";var r=n.content.querySelectorAll("button");for(var o=0;o<r.length;o++)r[o].addEventListener("click",s);r[0].focus();function s(e){var e=this.dataset["value"]=="yes";n.close();if(t)t(e)}return n},prompt:function(e,t,i){i=i||{};i.className="alert";i.title=i.title||"Prompt";i.width=i.width||280;if(typeof e=="string")e="<p>"+e+"</p>";var n=i.value||"";var r="<input type='text' value='"+n+"'/>";if(i.textarea)r="<textarea class='textfield' style='width:95%'>"+n+"</textarea>";e+="<p>"+r+"</p><button class='vjbutton' data-value='accept' style='width:45%; margin-left: 10px; margin-bottom: 10px'>Accept</button><button class='vjbutton' data-value='cancel' style='width:45%'>Cancel</button>";i.noclose=true;var o=this.showMessage(e,i);var s=o.content.querySelectorAll("button");for(var a=0;a<s.length;a++)s[a].addEventListener("click",c);var l=o.content.querySelector("input,textarea");l.addEventListener("keydown",u,true);function c(){var e=l.value;if(this.dataset&&this.dataset["value"]=="cancel")e=null;o.close();if(t)t(e)}function u(e){if(!e)e=window.event;var t=e.keyCode||e.which;if(t=="13"){c();return false}if(t=="29")o.close()}l.focus();return o},choice:function(e,t,i,n){n=n||{};n.className="alert";n.title=n.title||"Select one option";n.width=n.width||280;if(typeof e=="string")e="<p>"+e+"</p>";for(var r in t){e+="<button class='vjbutton' data-value='"+r+"' style='width:45%; margin-left: 10px'>"+(t[r].content||t[r])+"</button>"}n.noclose=true;var o=this.showMessage(e,n);o.content.style.paddingBottom="10px";var s=o.content.querySelectorAll("button");for(var r=0;r<s.length;r++)s[r].addEventListener("click",a);function a(e){var e=t[this.dataset["value"]];o.close();if(i)i(e)}return o},downloadURL:function(e,t){var i=document.createElement("a");i.href=e;i.download=t;document.body.appendChild(i);i.click();document.body.removeChild(i)},downloadFile:function(e,t,i){if(!t){console.warn("No file provided to download");return}if(!i){if(t.constructor===String)i="text/plain";else i="application/octet-stream"}var n=null;if(t.constructor!==File&&t.constructor!==Blob)n=new Blob([t],{type:i});else n=t;var r=URL.createObjectURL(n);var o=document.createElement("a");o.setAttribute("href",r);o.setAttribute("download",e);o.style.display="none";document.body.appendChild(o);o.click();document.body.removeChild(o);setTimeout(function(){URL.revokeObjectURL(r)},1e3*60)},getUrlVars:function(){var e=[],t;var i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var n=0;n<i.length;n++){t=i[n].split("=");e.push(t[0]);e[t[0]]=t[1]}return e},getUrlVar:function(e){return vjgui.getUrlVars()[e]},focus:function(e){e.focus()},blur:function(e){e.blur()},draggable:function(e,t,i,n,r){t=t||e;t.addEventListener("mousedown",u);t.style.cursor="move";var o=0;var s=0;var a=e.getClientRects()[0];var l=a?a.left:0;var c=a?a.top:0;e.style.position="absolute";e.style.left=l+"px";e.style.top=c+"px";function u(t){if(t.type=="mousedown"){if(!a){a=e.getClientRects()[0];l=a?a.left:0;c=a?a.top:0}if(r&&r(e,t)==false){t.stopPropagation();t.preventDefault();return false}o=t.clientX;s=t.clientY;document.addEventListener("mousemove",u);document.addEventListener("mouseup",u);if(i)i(e,t);t.stopPropagation();t.preventDefault();return false}if(t.type=="mouseup"){document.removeEventListener("mousemove",u);document.removeEventListener("mouseup",u);if(n)n(e,t);return}if(t.type=="mousemove"){var d=t.clientX-o;var h=t.clientY-s;o=t.clientX;s=t.clientY;l+=d;c+=h;e.style.left=l+"px";e.style.top=c+"px"}}},cloneObject:function(e,t){var i=t||{};for(var n in e){if(n[0]=="_"||n.substr(0,6)=="jQuery")continue;var r=e[n];if(r==null)i[n]=null;else if(isFunction(r))continue;else if(typeof r=="number"||typeof r=="string")i[n]=r;else if(r.constructor==Float32Array)i[n]=Array.apply([],r);else if(isArray(r)){if(i[n]&&i[n].constructor==Float32Array)i[n].set(r);else i[n]=JSON.parse(JSON.stringify(r))}else{try{i[n]=JSON.parse(JSON.stringify(r))}catch(e){console.error(e)}}}return i},safeName:function(e){return String(e).replace(/[\s\.]/g,"")},special_codes:{close:"&#10005;",navicon:"&#9776;",refresh:"&#8634;",gear:"&#9881;",open_folder:"&#128194;",download:"&#11123;",tick:"&#10003;",trash:"&#128465;"},htmlEncode:function(e){var t=document.createElement("div");t.innerHTML=e;return t.innerText},htmlDecode:function(e){var t=document.createElement("div");t.innerText=e;return t.innerHTML},sizeToCSS:function(e){if(e===undefined||e===null)return null;if(e.constructor===String)return e;if(e>=0)return(e|0)+"px";return"calc( 100% - "+Math.abs(e|0)+"px )"},getElementWindow:function(e){var t=e.ownerDocument;return t.defaultView||t.parentWindow},createDropArea:function(e,t,i,n){e.addEventListener("dragenter",r);function r(t){e.addEventListener("dragexit",r);e.addEventListener("dragover",r);e.addEventListener("drop",o);t.stopPropagation();t.preventDefault();if(t.type=="dragenter"&&i)i(t,this);if(t.type=="dragexit"&&n)n(t,this)}function o(i){i.stopPropagation();i.preventDefault();e.removeEventListener("dragexit",r);e.removeEventListener("dragover",r);e.removeEventListener("drop",o);var n=undefined;if(t)n=t(i);if(n){i.stopPropagation();i.stopImmediatePropagation();return true}}}};if(String.prototype.template==undefined){Object.defineProperty(String.prototype,"template",{value:function(e,t){var i=this;var n=/{{([^}}]+)?}}/g,r;while(r=n.exec(i)){var o=t?new Function("with(this) { try { return "+r[1]+"} catch(e) { return 'error';} }").call(e):e[r[1]];i=i.replace(r[0],o)}return i},enumerable:false})}function purgeElement(e,t){var i=e.attributes,n,r,o;if(i){for(n=i.length-1;n>=0;n-=1){o=i[n].name;if(typeof e[o]==="function"){e[o]=null}}}i=e.childNodes;if(i){r=i.length;for(n=0;n<r;n+=1){purgeElement(e.childNodes[n])}}}if(typeof escapeHtmlEntities=="undefined"){escapeHtmlEntities=function(e){return e.replace(/[\u00A0-\u2666<>\&]/g,function(e){return"&"+(escapeHtmlEntities.entityTable[e.charCodeAt(0)]||"#"+e.charCodeAt(0))+";"})};escapeHtmlEntities.entityTable={34:"quot",38:"amp",39:"apos",60:"lt",62:"gt",160:"nbsp",161:"iexcl",162:"cent",163:"pound",164:"curren",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",182:"para",183:"middot",184:"cedil",185:"sup1",186:"ordm",187:"raquo",188:"frac14",189:"frac12",190:"frac34",191:"iquest",192:"Agrave",193:"Aacute",194:"Acirc",195:"Atilde",196:"Auml",197:"Aring",198:"AElig",199:"Ccedil",200:"Egrave",201:"Eacute",202:"Ecirc",203:"Euml",204:"Igrave",205:"Iacute",206:"Icirc",207:"Iuml",208:"ETH",209:"Ntilde",210:"Ograve",211:"Oacute",212:"Ocirc",213:"Otilde",214:"Ouml",215:"times",216:"Oslash",217:"Ugrave",218:"Uacute",219:"Ucirc",220:"Uuml",221:"Yacute",222:"THORN",223:"szlig",224:"agrave",225:"aacute",226:"acirc",227:"atilde",228:"auml",229:"aring",230:"aelig",231:"ccedil",232:"egrave",233:"eacute",234:"ecirc",235:"euml",236:"igrave",237:"iacute",238:"icirc",239:"iuml",240:"eth",241:"ntilde",242:"ograve",243:"oacute",244:"ocirc",245:"otilde",246:"ouml",247:"divide",248:"oslash",249:"ugrave",250:"uacute",251:"ucirc",252:"uuml",253:"yacute",254:"thorn",255:"yuml",402:"fnof",913:"Alpha",914:"Beta",915:"Gamma",916:"Delta",917:"Epsilon",918:"Zeta",919:"Eta",920:"Theta",921:"Iota",922:"Kappa",923:"Lambda",924:"Mu",925:"Nu",926:"Xi",927:"Omicron",928:"Pi",929:"Rho",931:"Sigma",932:"Tau",933:"Upsilon",934:"Phi",935:"Chi",936:"Psi",937:"Omega",945:"alpha",946:"beta",947:"gamma",948:"delta",949:"epsilon",950:"zeta",951:"eta",952:"theta",953:"iota",954:"kappa",955:"lambda",956:"mu",957:"nu",958:"xi",959:"omicron",960:"pi",961:"rho",962:"sigmaf",963:"sigma",964:"tau",965:"upsilon",966:"phi",967:"chi",968:"psi",969:"omega",977:"thetasym",978:"upsih",982:"piv",8226:"bull",8230:"hellip",8242:"prime",8243:"Prime",8254:"oline",8260:"frasl",8472:"weierp",8465:"image",8476:"real",8482:"trade",8501:"alefsym",8592:"larr",8593:"uarr",8594:"rarr",8595:"darr",8596:"harr",8629:"crarr",8656:"lArr",8657:"uArr",8658:"rArr",8659:"dArr",8660:"hArr",8704:"forall",8706:"part",8707:"exist",8709:"empty",8711:"nabla",8712:"isin",8713:"notin",8715:"ni",8719:"prod",8721:"sum",8722:"minus",8727:"lowast",8730:"radic",8733:"prop",8734:"infin",8736:"ang",8743:"and",8744:"or",8745:"cap",8746:"cup",8747:"int",8756:"there4",8764:"sim",8773:"cong",8776:"asymp",8800:"ne",8801:"equiv",8804:"le",8805:"ge",8834:"sub",8835:"sup",8836:"nsub",8838:"sube",8839:"supe",8853:"oplus",8855:"otimes",8869:"perp",8901:"sdot",8968:"lceil",8969:"rceil",8970:"lfloor",8971:"rfloor",9001:"lang",9002:"rang",9674:"loz",9824:"spades",9827:"clubs",9829:"hearts",9830:"diams",338:"OElig",339:"oelig",352:"Scaron",353:"scaron",376:"Yuml",710:"circ",732:"tilde",8194:"ensp",8195:"emsp",8201:"thinsp",8204:"zwnj",8205:"zwj",8206:"lrm",8207:"rlm",8211:"ndash",8212:"mdash",8216:"lsquo",8217:"rsquo",8218:"sbquo",8220:"ldquo",8221:"rdquo",8222:"bdquo",8224:"dagger",8225:"Dagger",8240:"permil",8249:"lsaquo",8250:"rsaquo",8364:"euro"}}function beautifyCode(e,t,i){t=t||["abstract","else","instanceof","super","boolean","enum","int","switch","break","export","interface","synchronized","byte","extends","let","this","case","false","long","throw","catch","final","native","throws","char","finally","new","transient","class","float","null","true","const","for","package","try","continue","function","private","typeof","debugger","goto","protected","var","default","if","public","void","delete","implements","return","volatile","do","import","short","while","double","in","static","with"];e=e.replace(/\b(\w+)\b/g,function(e){if(t.indexOf(e)!=-1)return"<span class='rsv'>"+e+"</span>";return e});e=e.replace(/\b([0-9]+)\b/g,function(e){return"<span class='num'>"+e+"</span>"});e=e.replace(/(\w+\.\w+)/g,function(e){var t=e.split(".");return"<span class='obj'>"+t[0]+"</span>.<span class='prop'>"+t[1]+"</span>"});e=e.replace(/(\w+)\(/g,function(e){return"<span class='prop'>"+e.substr(0,e.length-1)+"</span>("});e=e.replace(/(\"(\\.|[^\"])*\")/g,function(e){return"<span class='str'>"+e+"</span>"});e=e.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,function(e){return"<span class='cmnt'>"+e.replace(/<[^>]*>/g,"")+"</span>"});if(!i)e="<style>.obj { color: #79B; } .prop { color: #B97; }\t.str,.num { color: #A79; } .cmnt { color: #798; } .rsv { color: #9AB; } </style>"+e;return e}function beautifyJSON(e,t){if(typeof e=="object")e=JSON.stringify(e);var i=["false","true","null"];e=e.replace(/(\w+)/g,function(e){if(i.indexOf(e)!=-1)return"<span class='rsv'>"+e+"</span>";return e});e=e.replace(/([0-9]+)/g,function(e){return"<span class='num'>"+e+"</span>"});e=e.replace(/(\w+\.\w+)/g,function(e){var t=e.split(".");return"<span class='obj'>"+t[0]+"</span>.<span class='prop'>"+t[1]+"</span>"});e=e.replace(/(\"(\\.|[^\"])*\")/g,function(e){return"<span class='str'>"+e+"</span>"});e=e.replace(/(\/\/[a-zA-Z0-9\?\!\(\)_ ]*)/g,function(e){return"<span class='cmnt'>"+e+"</span>"});if(!t)e="<style>.obj { color: #79B; } .prop { color: #B97; }\t.str { color: #A79; } .num { color: #B97; } .cmnt { color: #798; } .rsv { color: #9AB; } </style>"+e;return e}function dataURItoBlob(e){var t=e.indexOf(",");var i=atob(e.substr(t+1));var n=new ArrayBuffer(i.length);var r=new Uint8Array(n);var o=i.length;for(var s=0;s<o;s++){r[s]=i.charCodeAt(s)}var a=e.substr(5,t-5);a=a.substr(0,a.length-7);return new Blob([n],{type:a})}(function(){function e(e,t){t=t||{};if(typeof t==="function")t={callback:t};var i=this;var n=document.createElement("div");n.className="vjgui button";this.root=n;var r=document.createElement("button");r.className="vjbutton";this.content=r;n.appendChild(r);r.innerHTML=e;r.addEventListener("click",function(e){i.click()});this.click=function(){if(t.callback)t.callback.call(i)}}vjgui.Button=e;function t(e,t){t=t||{};e=e||"";var i=document.createElement("div");i.className="vjgui searchbox";var n=t.placeholder!=null?t.placeholder:"Search";i.innerHTML="<input value='"+e+"' placeholder='"+n+"'/>";this.input=i.querySelector("input");this.root=i;var r=this;this.input.onchange=function(e){var i=e.target.value;if(t.callback)t.callback.call(r,i)}}t.prototype.setValue=function(e){this.input.value=e;this.input.onchange()};t.prototype.getValue=function(){return this.input.value};vjgui.SearchBox=t;function i(e,t){t=t||{};this.options=t;var i=this;if(t.parentMenu){if(t.parentMenu.constructor!==this.constructor){console.error("parentMenu must be of class ContextMenu, ignoring it");t.parentMenu=null}else{this.parentMenu=t.parentMenu;this.parentMenu.lock=true;this.parentMenu.current_submenu=this}}if(t.event&&t.event.constructor.name!=="MouseEvent"&&t.event.constructor.name!=="PointerEvent"&&t.event.constructor.name!=="CustomEvent"){console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it.");t.event=null}var n=document.createElement("div");n.className="vjcontextmenu vjmenubar-panel";n.style.minWidth=100;n.style.minHeight=100;n.style.pointerEvents="none";setTimeout(function(){n.style.pointerEvents="auto"},100);n.addEventListener("mouseup",function(e){e.preventDefault();return true},true);n.addEventListener("contextmenu",function(e){if(e.button!=2)return false;e.preventDefault();return false},true);n.addEventListener("mousedown",function(e){if(e.button==2){i.close();e.preventDefault();return true}},true);this.root=n;if(t.title){var r=document.createElement("div");r.className="vjmenu-title";r.innerHTML=t.title;n.appendChild(r)}var o=0;for(var s in e){var a=e.constructor==Array?e[s]:s;if(a!=null&&a.constructor!==String)a=a.content===undefined?String(a):a.content;var l=e[s];this.addItem(a,l,t);o++}n.addEventListener("mouseleave",function(e){if(i.lock)return;if(n.closing_timer)clearTimeout(n.closing_timer);n.closing_timer=setTimeout(i.close.bind(i,e),500)});n.addEventListener("mouseenter",function(e){if(n.closing_timer)clearTimeout(n.closing_timer)});function c(e){var t=parseInt(n.style.top);n.style.top=(t+e.deltaY*.1).toFixed()+"px";e.preventDefault();return true}n.addEventListener("wheel",c,true);n.addEventListener("mousewheel",c,true);var u=document;if(t.event)u=t.event.target.ownerDocument;if(!u)u=document;u.body.appendChild(n);var d=t.left||0;var h=t.top||0;if(t.event){if(t.event.constructor.name!=="MouseEvent"&&t.event.constructor.name!=="PointerEvent"&&t.event.constructor.name!=="CustomEvent"){console.warn("Event passed to ContextMenu is not of type MouseEvent");t.event=null}else{d=t.event.pageX-10;h=t.event.pageY-10;if(t.title)h-=20;if(t.parentMenu){var f=t.parentMenu.root.getBoundingClientRect();d=f.left+f.width}var p=document.body.getBoundingClientRect();var v=n.getBoundingClientRect();if(d>p.width-v.width-10)d=p.width-v.width-10;if(h>p.height-v.height-10)h=p.height-v.height-10}}n.style.left=d+"px";n.style.top=h+"px"}i.prototype.addItem=function(e,t,i){var n=this;i=i||{};var r=document.createElement("div");r.className="vjmenu-entry submenu";var o=false;if(t===null){r.classList.add("separator")}else{r.innerHTML=t&&t.title?t.title:e;r.value=t;if(t){if(t.disabled){o=true;r.classList.add("disabled")}if(t.submenu||t.has_submenu)r.classList.add("has_submenu")}if(typeof t=="function"){r.dataset["value"]=e;r.onclick_callback=t}else r.dataset["value"]=t}this.root.appendChild(r);if(!o)r.addEventListener("click",a);if(i.autoopen)r.addEventListener("mouseenter",s);function s(e){var t=this.value;if(!t||!t.has_submenu)return;a.call(this,e)}function a(e){var t=this.value;var r=true;if(n.current_submenu)n.current_submenu.close(e);if(i.callback){var o=i.callback.call(n,t,i,e);if(o===true)r=false}if(t){if(t.callback&&!i.ignore_item_callbacks&&t.disabled!==true){var o=t.callback.call(this,t,i,e,n);if(o===true)r=false}if(t.submenu){if(!t.submenu.options)throw"ContextMenu submenu needs options";var s=new vjgui.ContextMenu(t.submenu.options,{callback:t.submenu.callback,event:e,parentMenu:n,ignore_item_callbacks:t.submenu.ignore_item_callbacks,title:t.submenu.title,autoopen:i.autoopen});r=false}}if(r&&!n.lock)n.close()}return r};i.prototype.close=function(e,t){if(this.root.parentNode)this.root.parentNode.removeChild(this.root);if(this.parentMenu&&!t){this.parentMenu.lock=false;this.parentMenu.current_submenu=null;if(e===undefined)this.parentMenu.close();else if(e&&!vjgui.isCursorOverElement(e,this.parentMenu.root))vjgui.trigger(this.parentMenu.root,"mouseleave",e)}if(this.current_submenu)this.current_submenu.close(e,true);if(this.root.closing_timer)clearTimeout(this.root.closing_timer)};i.prototype.getTopMenu=function(){if(this.options.parentMenu)return this.options.parentMenu.getTopMenu();return this};i.prototype.getFirstEvent=function(){if(this.options.parentMenu)return this.options.parentMenu.getFirstEvent();return this.options.event};vjgui.ContextMenu=i;vjgui.ContextualMenu=i;function n(e,t){var i=this;this.value=e;var n=this.root=document.createElement("span");n.className="vjcheckbox inputfield";n.dataset["value"]=e;var r=this.element=document.createElement("span");r.className="fixed flag checkbox "+(e?"on":"off");n.appendChild(r);n.addEventListener("click",o.bind(this));function o(e){this.setValue(this.root.dataset["value"]!="true");e.preventDefault();e.stopPropagation()}this.setValue=function(e){if(this.value===e)return;if(this.root.dataset["value"]==e.toString())return;this.root.dataset["value"]=e;if(e){this.element.classList.remove("off");this.element.classList.add("on")}else{this.element.classList.remove("on");this.element.classList.add("off")}var i=this.value;this.value=e;if(t)t(e,i)};this.getValue=function(){return this.value}}vjgui.Checkbox=n;function r(e,t){var i=document.createElement("span");i.className="listbox "+(e?"listopen":"listclosed");i.innerHTML=e?"&#9660;":"&#9658;";i.dataset["value"]=e?"open":"closed";i.addEventListener("click",n);i.on_change_callback=t;i.setEmpty=function(e){if(e)this.classList.add("empty");else this.classList.remove("empty")};i.expand=function(){this.setValue(true)};i.collapse=function(){this.setValue(false)};i.setValue=function(e){if(this.dataset["value"]==(e?"open":"closed"))return;if(!e){this.dataset["value"]="closed";this.innerHTML="&#9658;";this.classList.remove("listopen");this.classList.add("listclosed")}else{this.dataset["value"]="open";this.innerHTML="&#9660;";this.classList.add("listopen");this.classList.remove("listclosed")}if(t)t(this.dataset["value"])};i.getValue=function(){return this.dataset["value"]};function n(e){var t=e.target;t.setValue(this.dataset["value"]=="open"?false:true);if(this.stopPropagation)e.stopPropagation()}return i}vjgui.createLitebox=r;function o(e,t,i){i=i||{};var n=this.root=document.createElement("ul");n.id=e;n.className="vjlist";this.items=[];var r=this;this.callback=i.callback;for(var o in t){var s=document.createElement("li");s.className="list-item";s.data=t[o];s.dataset["value"]=t[o];var a="";if(typeof t[o]=="string")a=t[o]+"<span class='arrow'></span>";else{a=(t[o].name||t[o].title||"")+"<span class='arrow'></span>";if(t[o].id)s.id=t[o].id}s.innerHTML=a;s.addEventListener("click",function(){var e=n.querySelectorAll(".list-item.selected");for(var t=0;t<e.length;++t)e[t].classList.remove("selected");this.classList.add("selected");vjgui.trigger(r.root,"wchanged",this);if(r.callback)r.callback(this.data)});n.appendChild(s)}if(i.parent){if(i.parent.root)i.parent.root.appendChild(n);else i.parent.appendChild(n)}}o.prototype.getSelectedItem=function(){return this.root.querySelector(".list-item.selected")};o.prototype.setSelectedItem=function(e){var t=this.root.querySelectorAll(".list-item");for(var i=0;i<t.length;i++){var n=t[i];if(n.data==e){vjgui.trigger(n,"click");break}}};vjgui.List=o;function s(e,t){t=t||{};var i=this.root=document.createElement("div");var n=this;this.value=e;i.className="vjslider";this.setValue=function(e,n){var r=t.min||0;var o=t.max||1;if(e<r)e=r;else if(e>o)e=o;var s=o-r;var a=(e-r)/s;var l=(a*100).toFixed(1)+"%";var c=(a*100+2).toFixed(1)+"%";i.style.background="linear-gradient(to right, #999 "+l+", #FC0 "+c+", #333 "+c+")";if(e!=this.value){this.value=e;if(!n){vjgui.trigger(this.root,"change",e);if(this.onChange)this.onChange(e)}}};function r(e){var r=i.getBoundingClientRect();if(!r)return;var o=r.width;var s=e/o;var a=t.min||0;var l=t.max||1;var c=l-a;n.setValue(c*s+a)}var o=null;i.addEventListener("mousedown",function(e){var t,n;if(e.offsetX){t=e.offsetX;n=e.offsetY}else if(e.layerX){t=e.layerX;n=e.layerY}r(t);o=i.ownerDocument;o.addEventListener("mousemove",s);o.addEventListener("mouseup",a);e.preventDefault();e.stopPropagation()});function s(e){var t=i.getBoundingClientRect();if(!t)return;var n=e.x===undefined?e.pageX:e.x;var o=n-t.left;r(o);e.preventDefault();return false}function a(e){var t=o||document;o=null;t.removeEventListener("mousemove",s);t.removeEventListener("mouseup",a);e.preventDefault();return false}this.setValue(e)}vjgui.Slider=s;function a(e,t){t=t||{};var i=document.createElement("div");i.className="curve "+(t.extraclass?t.extraclass:"");i.style.minHeight="50px";i.style.width=t.width||"100%";i.bgcolor=t.bgcolor||"#222";i.pointscolor=t.pointscolor||"#5AF";i.linecolor=t.linecolor||"#444";i.value=e||[];i.xrange=t.xrange||[0,1];i.yrange=t.yrange||[0,1];i.defaulty=t.defaulty!=null?t.defaulty:.5;i.no_trespassing=t.no_trespassing||false;i.show_samples=t.show_samples||0;i.options=t;i.style.minWidth="50px";i.style.minHeight="20px";var n=document.createElement("canvas");n.width=t.width||200;n.height=t.height||50;i.appendChild(n);i.canvas=n;i.addEventListener("mousedown",l);i.getValueAt=function(e){if(e<i.xrange[0]||e>i.xrange[1])return i.defaulty;var t=[i.xrange[0],i.defaulty];var n=0;for(var r=0;r<i.value.length;r+=1){var o=i.value[r];if(e==o[0])return o[1];if(e<o[0]){n=(e-t[0])/(o[0]-t[0]);return t[1]*(1-n)+o[1]*n}t=o}o=[i.xrange[1],i.defaulty];n=(e-t[0])/(o[0]-t[0]);return t[1]*(1-n)+o[1]*n};i.resample=function(e){var t=[];var n=(i.xrange[1]-i.xrange[0])/e;for(var r=i.xrange[0];r<=i.xrange[1];r+=n){t.push(i.getValueAt(r))}return t};i.addValue=function(e){for(var t=0;t<i.value;t++){var n=i.value[t];if(n[0]<e[0])continue;i.value.splice(t,0,e);redraw();return}i.value.push(e);redraw()};function r(e){return[n.width*((i.xrange[1]-i.xrange[0])*e[0]+i.xrange[0]),n.height*((i.yrange[1]-i.yrange[0])*e[1]+i.yrange[0])]}function o(e){return[(e[0]/n.width-i.xrange[0])/(i.xrange[1]-i.xrange[0]),(e[1]/n.height-i.yrange[0])/(i.yrange[1]-i.yrange[0])]}var s=-1;i.redraw=function(){var e=n.parentNode.getBoundingClientRect();if(e&&n.width!=e.width&&e.width&&e.width<1e3)n.width=e.width;if(e&&n.height!=e.height&&e.height&&e.height<1e3)n.height=e.height;var t=n.getContext("2d");t.setTransform(1,0,0,1,0,0);t.translate(0,n.height);t.scale(1,-1);t.fillStyle=i.bgcolor;t.fillRect(0,0,n.width,n.height);t.strokeStyle=i.linecolor;t.beginPath();var o=r([i.xrange[0],i.defaulty]);t.moveTo(o[0],o[1]);for(var a in i.value){var l=i.value[a];o=r(l);t.lineTo(o[0],o[1])}o=r([i.xrange[1],i.defaulty]);t.lineTo(o[0],o[1]);t.stroke();for(var a=0;a<i.value.length;a+=1){var l=i.value[a];o=r(l);if(s==a)t.fillStyle="white";else t.fillStyle=i.pointscolor;t.beginPath();t.arc(o[0],o[1],s==a?4:2,0,Math.PI*2);t.fill()}if(i.show_samples){var c=i.resample(i.show_samples);t.fillStyle="#888";for(var a=0;a<c.length;a+=1){var l=[a*((i.xrange[1]-i.xrange[0])/i.show_samples)+i.xrange[0],c[a]];o=r(l);t.beginPath();t.arc(o[0],o[1],2,0,Math.PI*2);t.fill()}}};var a=[0,0];function l(e){document.addEventListener("mousemove",c);document.addEventListener("mouseup",u);var t=n.getBoundingClientRect();var r=e.clientX-t.left;var l=e.clientY-t.top;s=p(r,n.height-l);if(s==-1){var d=o([r,n.height-l]);i.value.push(d);v();s=i.value.indexOf(d)}a=[r,l];i.redraw();e.preventDefault();e.stopPropagation()}function c(e){var t=n.getBoundingClientRect();var r=e.clientX-t.left;var l=e.clientY-t.top;if(r<0)r=0;else if(r>n.width)r=n.width;if(l<0)l=0;else if(l>n.height)l=n.height;if(s!=-1&&f([e.clientX-t.left,e.clientY-t.top],[r,l])>n.height*.5){i.value.splice(s,1);u(e);return}var c=a[0]-r;var d=a[1]-l;var p=o([-c,d]);if(s!=-1){var g=i.xrange[0];var m=i.xrange[1];if(i.no_trespassing){if(s>0)g=i.value[s-1][0];if(s<i.value.length-1)m=i.value[s+1][0]}var y=i.value[s];y[0]+=p[0];y[1]+=p[1];if(y[0]<g)y[0]=g;else if(y[0]>m)y[0]=m;if(y[1]<i.yrange[0])y[1]=i.yrange[0];else if(y[1]>i.yrange[1])y[1]=i.yrange[1]}v();i.redraw();a[0]=r;a[1]=l;h();e.preventDefault();e.stopPropagation()}function u(e){s=-1;i.redraw();document.removeEventListener("mousemove",c);document.removeEventListener("mouseup",u);h();e.preventDefault();e.stopPropagation()}function d(e){i.redraw()}function h(){if(t.callback)t.callback.call(i,i.value);else vjgui.trigger(i,"change")}function f(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function p(e,t){var n=1e5;var o=8;var s=-1;for(var a=0;a<i.value.length;a++){var l=i.value[a];var c=r(l);var u=f([e,t],c);if(u<n&&u<o){n=u;s=a}}return s}function v(){var e=null;if(s!=-1)e=i.value[s];i.value.sort(function(e,t){return e[0]-t[0]});if(e)s=i.value.indexOf(e)}i.redraw();return i}vjgui.LineEditor=a;function l(e){e=e||{};this.root=document.createElement("div");this.root.className="vjcomplexlist";this.item_code=e.item_code||"<div class='listitem'><span class='tick'><span>"+vjgui.special_codes.tick+"</span></span><span class='title'></span><button class='trash'>"+vjgui.special_codes.close+"</button></div>";if(e.height)this.root.style.height=vjgui.sizeToCSS(e.height);this.selected=null;this.onItemSelected=null;this.onItemToggled=null;this.onItemRemoved=null}l.prototype.addTitle=function(e){var t=vjgui.createElement("div",".listtitle",e);this.root.appendChild(t);return t};l.prototype.addHTML=function(e,t){var i=vjgui.createElement("div",".listtext",e);if(t)i.addEventListener("mousedown",t);this.root.appendChild(i);return i};l.prototype.clear=function(){this.root.innerHTML=""};l.prototype.addItem=function(e,t,i,n){var r=t||e.content||e.name;var o=vjgui.createListItem(this.item_code,{".title":r});o.item=e;if(i)o.classList.add("enabled");if(!n)o.querySelector(".trash").style.display="none";var s=this;o.addEventListener("mousedown",function(t){t.preventDefault();this.setSelected(true);if(s.onItemSelected)s.onItemSelected(e,o)});o.querySelector(".tick").addEventListener("mousedown",function(t){t.preventDefault();o.classList.toggle("enabled");if(s.onItemToggled)s.onItemToggled(e,o,o.classList.contains("enabled"))});o.querySelector(".trash").addEventListener("mousedown",function(t){t.preventDefault();t.stopPropagation();t.stopImmediatePropagation();if(s.onItemRemoved)s.onItemRemoved(e,o)});o.setContent=function(e,t){if(t)o.querySelector(".title").innerHTML=e;else o.querySelector(".title").innerText=e};o.toggleEnabled=function(e){o.classList.toggle("enabled")};o.setSelected=function(e){vjgui.removeClass(s.root,"selected");if(e)this.classList.add("selected");else this.classList.remove("selected");s.selected=o.item};o.show=function(){this.style.display=""};o.hide=function(){this.style.display="none"};this.root.appendChild(o);return o};vjgui.ComplexList=l})();(function(){function e(e){e=e||{};this.root=document.createElement("div");this.root.className="vjconsole";this.root.innerHTML="<div class='log'></div><div class='foot'><input type='text'/></div>";this.log_element=this.root.querySelector(".log");this.input=this.root.querySelector("input");this.input.addEventListener("keydown",this.processKeyDown.bind(this));this._prompt=e.prompt||"]";this.onAutocomplete=null;this.onProcessCommand=null;this.history=[];this._history_offset=0}e.prototype.processKeyDown=function(e){if(this._input_blocked)return;if(e.keyCode==13){var t=this.input.value;var i=t.trim();this.addMessage(this._prompt+i,"me",true);this.input.value="";this.history.push(i);if(this.history.length>10)this.history.shift();if(this.onProcessCommand)this.onProcessCommand(i);this._history_offset=0}else if(e.keyCode==38||e.keyCode==40){this._history_offset+=e.keyCode==38?-1:1;if(this._history_offset>0)this._history_offset=0;else if(this._history_offset<-this.history.length)this._history_offset=-this.history.length;var n=this.history.length+this._history_offset;if(n<0)return;if(n>=this.history.length)this.input.value="";else this.input.value=this.history[n]}else if(e.keyCode==9){if(this.onAutocomplete)this.input.value=this.onAutocomplete(this.input.value);else return}else return;e.preventDefault();e.stopPropagation()};e.prototype.addMessage=function(e,t,i){var n=this.log_element;var r=null;if(e&&e.constructor===Array){for(var o=0;o<e.length;++o)s(e[o])}else if(e&&e.constructor===Object){s(JSON.stringify(e,null,""),this)}else s(e,this);function s(e,o){r=document.createElement("pre");if(i)r.innerText=e;else r.innerHTML=e;r.className="msg";if(t)r.className+=" "+t;n.appendChild(r);if(n.children.length>1e3)n.removeChild(n.children[0])}this.log_element.scrollTop=1e6;r.update=function(e){this.innerHTML=e};return r};e.prototype.log=function(){var e=Array.prototype.slice.call(arguments);var t=e.join(",");return this.addMessage(t,"msglog")};e.prototype.warn=function(){var e=Array.prototype.slice.call(arguments);var t=e.join(",");return this.addMessage(t,"msgwarn")};e.prototype.error=function(){var e=Array.prototype.slice.call(arguments);var t=e.join(",");return this.addMessage(t,"msgerror")};e.prototype.clear=function(){this.log_element.innerHTML=""};vjgui.Console=e})();(function(){function e(e,t){if(e&&e.constructor===String||t){var i=e;e=t||{};e.id=i;console.warn("vjgui.Area legacy parameter, use options as first parameter instead of id.")}e=e||{};var n=document.createElement("div");n.className="vjarea";if(e.id)n.id=e.id;if(e.className)n.className+=" "+e.className;this.root=n;this.root.vjarea=this;var r=e.width||"100%";var o=e.height||"100%";if(r<0)r="calc( 100% - "+Math.abs(r)+"px)";if(o<0)o="calc( 100% - "+Math.abs(o)+"px)";n.style.width=r;n.style.height=o;this.options=e;var s=this;this._computed_size=[this.root.offsetWidth,this.root.offserHeight];var a=document.createElement("div");if(e.content_id)a.id=e.content_id;a.className="vjareacontent";a.style.width="100%";a.style.height="100%";this.root.appendChild(a);this.content=a;this.split_direction="none";this.sections=[];if(e.autoresize)vjgui.bind(vjgui,"resized",function(){s.onResize()})}e.VERTICAL="vertical";e.HORIZONTAL="horizontal";e.splitbar_size=4;e.prototype.getSection=function(e){e=e||0;if(this.sections.length>e)return this.sections[e];return null};e.prototype.onResize=function(e){var t=[this.root.offsetWidth,this.root.offsetHeight];if(e&&this._computed_size&&t[0]==this._computed_size[0]&&t[1]==this._computed_size[1])return;this.sendResizeEvent(e)};e.prototype.sendResizeEvent=function(e){if(this.sections.length)for(var t in this.sections){var i=this.sections[t];i.onResize(e)}else{for(var n=0;n<this.root.childNodes.length;n++){var r=this.root.childNodes[n];if(r.vjarea)r.vjarea.onResize();else vjgui.trigger(r,"resize")}}if(this.onresize)this.onresize()};e.prototype.getWidth=function(){return this.root.offsetWidth};e.prototype.getHeight=function(){return this.root.offsetHeight};e.prototype.isVisible=function(){return this.root.style.display!="none"};e.prototype.adjustHeight=function(){if(!this.root.parentNode){console.error("Cannot adjust height of vjgui.Area without parent");return}var e=this.root.parentNode.offsetHeight;var t=this.root.getClientRects()[0].top;this.root.style.height="calc( 100% - "+t+"px )"};e.prototype.split=function(t,i,n){if(!t||t.constructor!==String)throw"First parameter must be a string: 'vertical' or 'horizontal'";if(!i)i=["50%",null];if(t!="vertical"&&t!="horizontal")throw"First parameter must be a string: 'vertical' or 'horizontal'";if(this.sections.length)throw"cannot split twice";var r=new vjgui.Area({content_id:this.content.id});r.root.style.display="inline-block";var o=new vjgui.Area;o.root.style.display="inline-block";var s="";var a=null;var l=null;if(n){s=" - "+(e.splitbar_size+2)+"px";a=document.createElement("div");a.className="vjsplitbar "+t;if(t=="vertical")a.style.height=e.splitbar_size+"px";else a.style.width=e.splitbar_size+"px";this.splitbar=a;a.addEventListener("mousedown",m)}i=i||["50%",null];if(t=="vertical"){r.root.style.width="100%";o.root.style.width="100%";if(i[0]==null){var c=i[1];if(typeof c=="number")c=i[1]+"px";r.root.style.height="-moz-calc( 100% - "+c+s+" )";r.root.style.height="-webkit-calc( 100% - "+c+s+" )";r.root.style.height="calc( 100% - "+c+s+" )";o.root.style.height=c;o.size=c;l=r}else if(i[1]==null){var c=i[0];if(typeof c=="number")c=i[0]+"px";r.root.style.height=c;r.size=c;o.root.style.height="-moz-calc( 100% - "+c+s+" )";o.root.style.height="-webkit-calc( 100% - "+c+s+" )";o.root.style.height="calc( 100% - "+c+s+" )";l=o}else{var u=i[0];if(typeof u=="number")u=i[0]+"px";var d=i[1];if(typeof d=="number")d=i[1]+"px";r.root.style.height=u;r.size=u;o.root.style.height=d;o.size=d}}else{r.root.style.height="100%";o.root.style.height="100%";if(i[0]==null){var h=i[1];if(typeof h=="number")h=i[1]+"px";r.root.style.width="-moz-calc( 100% - "+h+s+" )";r.root.style.width="-webkit-calc( 100% - "+h+s+" )";r.root.style.width="calc( 100% - "+h+s+" )";o.root.style.width=h;o.size=i[1];l=r}else if(i[1]==null){var h=i[0];if(typeof h=="number")h=i[0]+"px";r.root.style.width=h;r.size=h;o.root.style.width="-moz-calc( 100% - "+h+s+" )";o.root.style.width="-webkit-calc( 100% - "+h+s+" )";o.root.style.width="calc( 100% - "+h+s+" )";l=o}else{var f=i[0];if(typeof f=="number")f=i[0]+"px";var p=i[1];if(typeof p=="number")p=i[1]+"px";r.root.style.width=f;r.size=f;o.root.style.width=p;o.size=p}}r.root.removeChild(r.content);r.root.appendChild(this.content);r.content=this.content;this.root.appendChild(r.root);if(a)this.root.appendChild(a);this.root.appendChild(o.root);this.sections=[r,o];this.dynamic_section=l;this.direction=t;var v=this;var g=[0,0];function m(e){var t=v.root.ownerDocument;t.addEventListener("mousemove",y);t.addEventListener("mouseup",b);g[0]=e.pageX;g[1]=e.pageY;e.stopPropagation();e.preventDefault()}function y(e){if(t=="horizontal"){if(g[0]!=e.pageX)v.moveSplit(g[0]-e.pageX)}else if(t=="vertical"){if(g[1]!=e.pageY)v.moveSplit(e.pageY-g[1])}g[0]=e.pageX;g[1]=e.pageY;e.stopPropagation();e.preventDefault();if(v.options.immediateResize||v.options.inmediateResize)v.onResize()}function b(e){var t=v.root.ownerDocument;t.removeEventListener("mousemove",y);t.removeEventListener("mouseup",b);v.onResize()}};e.prototype.hide=function(){this.root.style.display="none"};e.prototype.show=function(){this.root.style.display="block"};e.prototype.showSection=function(e){var t=this.sections[e];var i=0;if(t&&t.root.style.display!="none")return;if(this.direction=="horizontal")i=t.root.style.width;else i=t.root.style.height;if(i.indexOf("calc")!=-1)i="50%";for(var n in this.sections){var t=this.sections[n];if(n==e)t.root.style.display="inline-block";else{if(this.direction=="horizontal")t.root.style.width="calc( 100% - "+i+" - 5px)";else t.root.style.height="calc( 100% - "+i+" - 5px)"}}if(this.splitbar)this.splitbar.style.display="inline-block";this.sendResizeEvent()};e.prototype.hideSection=function(e){for(var t in this.sections){var i=this.sections[t];if(t==e)i.root.style.display="none";else{if(this.direction=="horizontal")i.root.style.width="100%";else i.root.style.height="100%"}}if(this.splitbar)this.splitbar.style.display="none";this.sendResizeEvent()};e.prototype.moveSplit=function(t){if(!this.sections)return;var i=this.sections[0];var n=this.sections[1];var r=" - "+e.splitbar_size+"px";var o=this.options.minSplitSize||10;if(this.direction=="horizontal"){if(this.dynamic_section==i){var s=n.root.offsetWidth+t;if(s<o)s=o;i.root.style.width="-moz-calc( 100% - "+s+"px "+r+" )";i.root.style.width="-webkit-calc( 100% - "+s+"px "+r+" )";i.root.style.width="calc( 100% - "+s+"px "+r+" )";n.root.style.width=s+"px"}else{var s=i.root.offsetWidth-t;if(s<o)s=o;n.root.style.width="-moz-calc( 100% - "+s+"px "+r+" )";n.root.style.width="-webkit-calc( 100% - "+s+"px "+r+" )";n.root.style.width="calc( 100% - "+s+"px "+r+" )";i.root.style.width=s+"px"}}else if(this.direction=="vertical"){if(this.dynamic_section==i){var s=n.root.offsetHeight-t;if(s<o)s=o;i.root.style.height="-moz-calc( 100% - "+s+"px "+r+" )";i.root.style.height="-webkit-calc( 100% - "+s+"px "+r+" )";i.root.style.height="calc( 100% - "+s+"px "+r+" )";n.root.style.height=s+"px"}else{var s=i.root.offsetHeight+t;if(s<o)s=o;n.root.style.height="-moz-calc( 100% - "+s+"px "+r+" )";n.root.style.height="-webkit-calc( 100% - "+s+"px "+r+" )";n.root.style.height="calc( 100% - "+s+"px "+r+" )";i.root.style.height=s+"px"}}vjgui.trigger(this.root,"split_moved");var a=this.root.querySelectorAll(".vjarea");for(var l=0;l<a.length;++l)vjgui.trigger(a[l],"split_moved")};e.prototype.addEventListener=function(e,t,i,n){return this.root.addEventListener(e,t,i,n)};e.prototype.setAreaSize=function(t,i){var n=this.sections[1];var r=" - "+e.splitbar_size+"px";n.root.style.width="-moz-calc( 100% - "+i+r+" )";n.root.style.width="-webkit-calc( 100% - "+i+r+" )";n.root.style.width="calc( 100% - "+i+r+" )"};e.prototype.merge=function(e){if(this.sections.length==0)throw"not splitted";var t=this.sections[e||0];this.root.appendChild(t.content);this.content=t.content;this.root.removeChild(this.sections[0].root);this.root.removeChild(this.sections[1].root);this.sections=[];this._computed_size=null;this.onResize()};e.prototype.add=function(e){if(typeof e=="string"){var t=document.createElement("div");t.innerHTML=e;e=t}this.content.appendChild(e.root||e)};e.prototype.query=function(e){return this.root.querySelector(e)};vjgui.Area=e;function t(e,t,i){t=t||{};if(e&&e.constructor===String){var n=e;e=t;t=i||{};t.id=n;console.warn("vjgui.Split legacy parameter, use sections as first parameter instead of id.")}var r=document.createElement("div");this.root=r;if(t.id)r.id=n;r.className="vjsplit "+(t.vertical?"vsplit":"hsplit");this.sections=[];for(var o in e){var s=document.createElement("div");s.className="split-section split"+o;if(typeof e[o]=="number"){if(t.vertical)s.style.height=e[o].toFixed(1)+"%";else s.style.width=e[o].toFixed(1)+"%"}else if(typeof e[o]=="string"){if(t.vertical)s.style.height=e[o];else s.style.width=e[o]}else{if(e[o].id)s.id=e[o].id;if(t.vertical)s.style.height=typeof e[o].height=="Number"?e[o].height.toFixed(1)+"%":e[o].height;else s.style.width=typeof e[o].width=="Number"?e[o].width.toFixed(1)+"%":e[o].width}s.add=function(e){this.appendChild(e.root||e)};this.sections.push(s);r.appendChild(s)}if(t.parent){if(t.parent.root)t.parent.root.appendChild(r);else t.parent.appendChild(r)}this.getSection=function(e){return this.sections[e]}}vjgui.Split=t})();(function(){function e(e,t){t=t||{};this.menu=[];this.panels=[];this.root=document.createElement("div");this.root.id=e;this.root.className="vjmenubar";this.content=document.createElement("ul");this.root.appendChild(this.content);this.is_open=false;this.auto_open=t.auto_open||false;this.sort_entries=t.sort_entries||false}e.closing_time=500;e.prototype.clear=function(){this.content.innerHTML="";this.menu=[];this.panels=[]};e.prototype.attachToPanel=function(e){e.content.insertBefore(this.root,e.content.firstChild)};e.prototype.add=function(e,t){t=t||{};if(typeof t=="function")t={callback:t};var i=this.menu.length;var n=e.split("/");var r=0;var o=0;var s=this.menu;var a=null;while(s){if(r>5)throw"Error: Menubar too deep";if(s.length==o){var l={parent:a,children:[]};a=l;if(r==n.length-1)l.data=t;l.disable=function(){if(this.data)this.data.disabled=true};l.enable=function(){if(this.data)delete this.data.disabled};l.name=n[r];s.push(l);r++;if(r==n.length)break;l.children=[];s=l.children;o=0;continue}if(s[o]&&n[r]==s[o].name){if(r<n.length-1){a=s[o];s=s[o].children;o=0;r++;continue}else{console.warn("Warning: Adding menu that already exists: "+e);break}}o++}if(i!=this.menu.length)this.updateMenu()};e.prototype.remove=function(e){var t=this.findMenu(e);if(!t)return;if(!t.parent||!t.parent.children)return console.warn("menu without parent?");var i=t.parent.children.indexOf(t);if(i!=-1)t.parent.children.splice(i,1)},e.prototype.separator=function(e,t){var i=this.findMenu(e);if(!i)return;i.children.push({separator:true,order:t||10})};e.prototype.findMenu=function(e){var t=e.split("/");var i=0;var n=0;var r=this.menu;while(r){if(i==t.length)return r;if(r.length<=n)return null;if(t[i]=="*")return r[n].children;if(t[i]==r[n].name){if(i==t.length-1){return r[n]}else{r=r[n].children;n=0;i++;continue}}n++}return null};e.prototype.updateMenu=function(){var e=this;this.content.innerHTML="";for(var t in this.menu){var i=document.createElement("li");i.innerHTML="<span class='icon'></span><span class='name'>"+this.menu[t].name+"</span>";this.content.appendChild(i);i.data=this.menu[t];this.menu[t].element=i;i.addEventListener("click",function(t){var i=this.data;if(i.data&&i.data.callback&&typeof i.data.callback=="function")i.data.callback(i.data);if(!e.is_open){e.is_open=true;e.showMenu(i,t,this)}else{e.is_open=false;e.hidePanels()}});i.addEventListener("mouseover",function(t){e.hidePanels();if(e.is_open||e.auto_open)e.showMenu(this.data,t,this)})}};e.prototype.hidePanels=function(){if(!this.panels.length)return;for(var e in this.panels)vjgui.remove(this.panels[e]);this.panels=[]};e.prototype.showMenu=function(e,t,i,n){if(!n)this.hidePanels();if(!e.children||!e.children.length)return;var r=this;if(r.closing_by_leave)clearInterval(r.closing_by_leave);var o=document.createElement("div");o.className="vjmenubar-panel";var s=[];for(var a in e.children)s.push(e.children[a]);if(this.sort_entries)s.sort(function(e,t){var i=10;var n=10;if(e&&e.data&&e.data.order!=null)i=e.data.order;if(e&&e.separator&&e.order!=null)i=e.order;if(t&&t.data&&t.data.order!=null)n=t.data.order;if(t&&t.separator&&t.order!=null)n=t.order;return i-n});for(var a in s){var l=document.createElement("p");var c=s[a];l.className="vjmenu-entry "+(l.children?" submenu":"");var u=c.children&&c.children.length;if(u)l.classList.add("has_submenu");if(c&&c.name)l.innerHTML="<span class='icon'></span><span class='name'>"+c.name+(u?"<span class='more'>+</span>":"")+"</span>";else{l.classList.add("separator")}l.data=c;if(l.data.data){var d=l.data.data;var h=d.type=="checkbox"&&d.instance&&d.property&&d.instance[d.property]==true||d.checkbox==true||d.instance&&d.property&&d.hasOwnProperty("value")&&d.instance[d.property]==d.value||typeof d.isChecked=="function"&&d.isChecked.call(d.instance,d);if(h)l.className+=" checked";if(d.disabled)l.className+=" disabled"}l.addEventListener("click",function(){var e=this.data;if(e.data){if(e.data.disabled)return;if(e.data.instance&&e.data.property){if(e.data.type=="checkbox"){e.data.instance[e.data.property]=!e.data.instance[e.data.property];if(e.data.instance[e.data.property])this.classList.add("checked");else this.classList.remove("checked")}else if(e.data.hasOwnProperty("value")){e.data.instance[e.data.property]=e.data.value}}if(e.data.checkbox!=null){e.data.checkbox=!e.data.checkbox;if(e.data.checkbox)this.classList.add("checked");else this.classList.remove("checked")}if(e.data.callback&&typeof e.data.callback=="function")e.data.callback(e.data)}if(e.children&&e.children.length){r.showMenu(e,t,this,true)}else{r.is_open=false;r.hidePanels()}});l.addEventListener("mouseenter",function(e){});o.appendChild(l)}o.addEventListener("mouseleave",function(e){if(r.closing_by_leave)clearInterval(r.closing_by_leave);r.closing_by_leave=setTimeout(function(){r.is_open=false;r.hidePanels()},vjgui.Menubar.closing_time)});o.addEventListener("mouseenter",function(e){if(r.closing_by_leave)clearInterval(r.closing_by_leave);r.closing_by_leave=null});var f=i.getBoundingClientRect();o.style.left=f.left+(n?200:0)+"px";o.style.top=f.top+f.height+(n?-20:10)+"px";this.panels.push(o);document.body.appendChild(o)};vjgui.Menubar=e})();(function(){function e(e,t){if(t||e&&e.constructor===String){var i=e;e=t||{};e.id=i;console.warn("vjgui.Tabs legacy parameter, use options as first parameter instead of id.")}e=e||{};this.options=e;var n=this.mode=e.mode||"horizontal";var r=document.createElement("DIV");if(e.id)r.id=e.id;r.data=this;r.className="vjtabs "+n;this.root=r;this.root.tabs=this;this.current_tab=null;if(n=="horizontal"){if(e.size){if(e.size=="full")this.root.style.height="100%";else this.root.style.height=e.size}}else if(n=="vertical"){if(e.size){if(e.size=="full")this.root.style.width="100%";else this.root.style.width=e.size}}if(e.width)this.root.style.width=e.width.constructor===Number?e.width.toFixed(0)+"px":e.width;if(e.height)this.root.style.height=e.height.constructor===Number?e.height.toFixed(0)+"px":e.height;var o=document.createElement("UL");o.className="wtabcontainer";if(n=="vertical")o.style.width=vjgui.Tabs.tabs_width+"px";else o.style.height=vjgui.Tabs.tabs_height+"px";o.addEventListener("wheel",s);o.addEventListener("mousewheel",s);function s(e){if(e.deltaY)o.scrollLeft+=e.deltaY}this.list=o;this.root.appendChild(this.list);this.tabs_root=o;this.tabs={};this.tabs_by_index=[];this.selected=null;this.onchange=e.callback;if(e.parent)this.appendTo(e.parent)}e.tabs_width=64;e.tabs_height=26;e.prototype.show=function(){this.root.style.display="block"};e.prototype.hide=function(){this.root.style.display="none"};e.prototype.getCurrentTab=function(){if(!this.current_tab)return null;return this.tabs[this.current_tab[0]]};e.prototype.getCurrentTabId=function(){return this.current_tab[0]};e.prototype.getPreviousTab=function(){if(!this.previous_tab)return null;return this.tabs[this.previous_tab[0]]};e.prototype.appendTo=function(e,t){if(t)e.prepend(this.root);else e.appendChild(this.root)};e.prototype.getTab=function(e){return this.tabs[e]};e.prototype.getTabByIndex=function(e){return this.tabs_by_index[e]};e.prototype.getNumOfTabs=function(){var e=0;for(var t in this.tabs)e++;return e};e.prototype.getTabContent=function(e){var t=this.tabs[e];if(t)return t.content};e.prototype.getTabIndex=function(e){var t=this.tabs[e];if(!t)return-1;for(var i=0;i<this.list.childNodes.length;i++)if(this.list.childNodes[i]==t.tab)return i;return-1};e.prototype.addTab=function(t,i,n){i=i||{};if(typeof i=="function")i={callback:i};var r=this;if(t===undefined||t===null)t="rand_"+(Math.random()*1e6|0);var o=document.createElement("LI");var s=t.replace(/ /gi,"_");o.className="wtab wtab-"+s+" ";o.dataset["id"]=t;o.innerHTML="<span class='tabtitle'>"+(i.title||t)+"</span>";if(i.button)o.className+="button ";if(i.tab_className)o.className+=i.tab_className;if(i.bigicon)o.innerHTML="<img class='tabbigicon' src='"+i.bigicon+"'/>"+o.innerHTML;if(i.closable){o.innerHTML+="<span class='tabclose'>"+vjgui.special_codes.close+"</span>";o.querySelector("span.tabclose").addEventListener("click",function(e){r.removeTab(t);e.preventDefault();e.stopPropagation()},true)}if(i.index!==undefined){var a=this.list.childNodes[i.index];if(a)this.list.insertBefore(o,a);else this.list.appendChild(o)}else if(this.plus_tab)this.list.insertBefore(o,this.plus_tab);else this.list.appendChild(o);if(i.tab_width){o.style.width=i.tab_width.constructor===Number?i.tab_width.toFixed(0)+"px":i.tab_width;o.style.minWidth="0"}if(this.options.autoswitch){o.classList.add("autoswitch");o.addEventListener("dragenter",function(e){if(r._timeout_mouseover)clearTimeout(r._timeout_mouseover);r._timeout_mouseover=setTimeout(function(){vjgui.trigger(this,"click");r._timeout_mouseover=null}.bind(this),500)});o.addEventListener("dragleave",function(e){if(r._timeout_mouseover){clearTimeout(r._timeout_mouseover);r._timeout_mouseover=null}})}var l=document.createElement("div");if(i.id)l.id=i.id;l.className="wtabcontent "+"wtabcontent-"+s+" "+(i.className||"");l.dataset["id"]=t;l.style.display="none";if(this.mode=="horizontal"){if(i.size){l.style.overflow="auto";if(i.size=="full"){l.style.width="100%";l.style.height="calc( 100% - "+vjgui.Tabs.tabs_height+"px )";l.style.height="-moz-calc( 100% - "+vjgui.Tabs.tabs_height+"px )";l.style.height="-webkit-calc( 100% - "+vjgui.Tabs.tabs_height+"px )"}else l.style.height=i.size}}else if(this.mode=="vertical"){if(i.size){l.style.overflow="auto";if(i.size=="full"){l.style.height="100%";l.style.width="calc( 100% - "+vjgui.Tabs.tabs_width+"px )";l.style.width="-moz-calc( 100% - "+vjgui.Tabs.tabs_width+"px )";l.style.width="-webkit-calc( 100% - "+vjgui.Tabs.tabs_width+"px )"}else l.style.width=i.size}}if(i.width!==undefined)l.style.width=typeof i.width==="string"?i.width:i.width+"px";if(i.height!==undefined)l.style.height=typeof i.height==="string"?i.height:i.height+"px";if(i.content){if(typeof i.content=="string")l.innerHTML=i.content;else l.appendChild(i.content)}this.root.appendChild(l);if(!i.button)o.addEventListener("click",e.prototype.onTabClicked);else o.addEventListener("click",function(e){var t=this.dataset["id"];if(i.callback)i.callback(t,e)});o.options=i;o.tabs=this;var c=o.querySelector("span.tabtitle");var u={id:t,tab:o,content:l,title:c,add:function(e){this.content.appendChild(e.root||e)},setTitle:function(e){this.title.innerHTML=e},click:function(){vjgui.trigger(this.tab,"click")},destroy:function(){r.removeTab(this.id)}};if(i.onclose)u.onclose=i.onclose;this.tabs[t]=u;this.recomputeTabsByIndex();o.addEventListener("contextmenu",function(e){if(e.button!=2)return false;e.preventDefault();if(i.callback_context)i.callback_context.call(u);return false}.bind(this));if(i.selected==true||this.selected==null)this.selectTab(t,i.skip_callbacks);return u};e.prototype.addPlusTab=function(e){if(this.plus_tab)console.warn("There is already a plus tab created in this tab widget");this.plus_tab=this.addTab("plus_tab",{title:"+",tab_width:20,button:true,callback:e,skip_callbacks:true})};e.prototype.addButtonTab=function(e,t,i){return this.addTab(e,{title:t,tab_width:20,button:true,callback:i,skip_callbacks:true})};e.prototype.onTabClicked=function(e){if(this.classList.contains("selected"))return;if(!this.parentNode)return;var t=this.options;var i=this.parentNode.parentNode.tabs;if(!i)throw"tabs not found";var n=i;if(t.callback_canopen&&t.callback_canopen()==false)return;if(n.current_tab&&n.current_tab[0]!=r&&n.current_tab[2]&&n.current_tab[2].callback_leave)n.current_tab[2].callback_leave(n.current_tab[0],n.current_tab[1],n.current_tab[2]);var r=this.dataset["id"];var o=null;for(var s in n.tabs){var a=n.tabs[s];if(s==r){a.selected=true;a.content.style.display="";o=a.content}else{delete a.selected;a.content.style.display="none"}}var l=n.list.querySelectorAll("li.wtab");for(var s=0;s<l.length;++s)l[s].classList.remove("selected");this.classList.add("selected");n.previous_tab=n.current_tab;n.current_tab=[r,o,t];if(e){if(t.callback)t.callback(r,o,e);vjgui.trigger(n,"wchange",[r,o]);if(n.onchange)n.onchange(r,o)}n.selected=r};e.prototype.selectTab=function(e,t){if(!e)return;if(e.constructor!=String)e=e.id;var i=this.list.querySelectorAll("li.wtab");for(var n=0;n<i.length;n++)if(e==i[n].dataset["id"]){this.onTabClicked.call(i[n],!t);break}};e.prototype.setTabVisibility=function(e,t){var i=this.tabs[e];if(!i)return;i.tab.style.display=t?"none":null;i.content.style.display=t?"none":null};e.prototype.recomputeTabsByIndex=function(){this.tabs_by_index=[];for(var e in this.tabs){var t=this.tabs[e];var i=0;var n=t.tab;while((n=n.previousSibling)!=null)i++;this.tabs_by_index[i]=t}};e.prototype.removeTab=function(e){var t=this.tabs[e];if(!t){console.warn("tab not found: "+e);return}if(t.onclose)t.onclose(t);if(t.tab.parentNode)t.tab.parentNode.removeChild(t.tab);if(t.content.parentNode)t.content.parentNode.removeChild(t.content);delete this.tabs[e];this.recomputeTabsByIndex()};e.prototype.removeAllTabs=function(e){var t=[];for(var i in this.tabs)t.push(this.tabs[i]);for(var i in t){var n=t[i];if(n==this.plus_tab&&e)continue;if(n.tab.parentNode)n.tab.parentNode.removeChild(n.tab);if(n.content.parentNode)n.content.parentNode.removeChild(n.content);delete this.tabs[n.id]}this.recomputeTabsByIndex()};e.prototype.clear=function(){this.removeAllTabs()};e.prototype.hideTab=function(e){this.setTabVisibility(e,false)};e.prototype.showTab=function(e){this.setTabVisibility(e,true)};e.prototype.transferTab=function(e,t,i){var n=this.tabs[e];if(!n)return;t.tabs[e]=n;if(i!==undefined)t.list.insertBefore(n.tab,t.list.childNodes[i]);else t.list.appendChild(n.tab);t.root.appendChild(n.content);delete this.tabs[e];var r=null;for(var o in this.tabs){r=o;break}if(r)this.selectTab(r);n.tab.classList.remove("selected");t.selectTab(e)};e.prototype.detachTab=function(e,t,i){var n=this.tabs[e];if(!n)return;var r=this.getTabIndex(e);var o=800;var s=600;var a=window.open("","","width="+o+", height="+s+", location=no, status=no, menubar=no, titlebar=no, fullscreen=yes");a.document.write("<head><title>"+e+"</title>");var l=document.querySelectorAll("link[rel='stylesheet'],style");for(var c=0;c<l.length;c++)a.document.write(l[c].outerHTML);a.document.write("</head><body></body>");a.document.close();var u=this;var d=new vjgui.Tabs(null,this.options);a.tabs=d;a.onbeforeunload=function(){d.transferTab(e,u,r);if(i)i()};d.list.style.height="20px";a.document.body.appendChild(d.root);u.transferTab(e,d);d.tabs[e].tab.classList.add("selected");this.recomputeTabsByIndex();if(t)t();return a};vjgui.Tabs=e})();(function(){function e(e,t){if(e===null||e===undefined)e=0;else if(e.constructor===String)e=parseFloat(e);else if(e.constructor!==Number)e=0;this.value=e;var i=this;var n=t.precision!=undefined?t.precision:3;this.options=t||{};var r=document.createElement("div");r.className="dragger "+(t.extraclass?t.extraclass:"");this.root=r;var o=document.createElement("span");o.className="inputfield "+(t.extraclass?t.extraclass:"")+(t.full?" full":"");if(t.disabled)o.className+=" disabled";r.appendChild(o);var s=t.dragger_class||"full";var a=document.createElement("input");a.className="text number "+(s?s:"");a.value=e.toFixed(n)+(t.units?t.units:"");a.tabIndex=t.tab_index;this.input=a;r.input=a;if(t.disabled)a.disabled=true;if(t.tab_index)a.tabIndex=t.tab_index;o.appendChild(a);a.addEventListener("keydown",function(e){if(e.keyCode==38)p(1,e);else if(e.keyCode==40)p(-1,e);else return;e.stopPropagation();e.preventDefault();return true});var l=document.createElement("div");l.className="drag_widget";if(t.disabled)l.className+=" disabled";o.appendChild(l);r.dragger=l;l.addEventListener("mousedown",u);a.addEventListener("wheel",h,false);a.addEventListener("mousewheel",h,false);var c=null;function u(e){c=a.ownerDocument;c.removeEventListener("mousemove",d);c.removeEventListener("mouseup",f);if(!t.disabled){if(r.requestPointerLock)r.requestPointerLock();c.addEventListener("mousemove",d);c.addEventListener("mouseup",f);l.data=[e.screenX,e.screenY];vjgui.trigger(r,"start_dragging")}e.stopPropagation();e.preventDefault()}function d(e){var i=e.screenX-l.data[0];var n=l.data[1]-e.screenY;var r=[i,n];if(e.movementX!==undefined)r=[e.movementX,-e.movementY];l.data=[e.screenX,e.screenY];var o=t.horizontal?0:1;p(r[o],e);e.stopPropagation();e.preventDefault();return false}function h(e){if(document.activeElement!==this)return;var t=e.wheelDelta!==undefined?e.wheelDelta:e.deltaY?-e.deltaY/3:0;p(t>0?1:-1,e);e.stopPropagation();e.preventDefault()}function f(e){vjgui.trigger(r,"stop_dragging");var t=c||document;c=null;t.removeEventListener("mousemove",d);t.removeEventListener("mouseup",f);if(t.exitPointerLock)t.exitPointerLock();vjgui.trigger(l,"blur");e.stopPropagation();e.preventDefault();return false}function p(e,i){if(!t.linear)e=e>0?Math.pow(e,1.2):Math.pow(Math.abs(e),1.2)*-1;var r=t.step?t.step:1;if(i&&i.shiftKey)r*=10;else if(i&&i.ctrlKey)r*=.1;var o=parseFloat(a.value)+e*r;if(t.max!=null&&o>t.max)o=t.max;if(t.min!=null&&o<t.min)o=t.min;a.value=o.toFixed(n);if(t.units)a.value+=t.units;vjgui.trigger(a,"change")}}e.prototype.setRange=function(e,t){this.options.min=e;this.options.max=t};e.prototype.setValue=function(e,t){e=parseFloat(e);this.value=e;if(this.options.precision)e=e.toFixed(this.options.precision);if(this.options.units)e+=this.options.units;this.input.value=e;if(!t)vjgui.trigger(this.input,"change")};e.prototype.getValue=function(){return this.value};vjgui.Dragger=e})();(function(){function e(e,t,i){if(i||e&&e.constructor===String){var n=e;e=t;t=i||{};t.id=n;console.warn("vjgui.Tree legacy parameter, use data as first parameter instead of id.")}t=t||{};var r=document.createElement("div");this.root=r;if(t.id)r.id=t.id;r.className="vjtree";this.tree=e;var o=this;t=t||{allow_rename:false,allow_drag:true,allow_multiselection:false};this.options=t;this.indent_offset=t.indent_offset||0;if(t.height)this.root.style.height=typeof t.height=="string"?t.height:Math.round(t.height)+"px";this.collapsed_depth=3;if(t.collapsed_depth!=null)this.collapsed_depth=t.collapsed_depth;r.addEventListener("click",function(e){if(e.srcElement!=o.root)return;if(o.onBackgroundClicked)o.onBackgroundClicked(e,o)});r.addEventListener("contextmenu",function(e){if(e.button!=2)return false;if(o.onContextMenu)o.onContextMenu(e);e.preventDefault();return false});var s=this.createAndInsert(e,t,null);if(!s)throw"Error in vjgui.Tree, createAndInsert returned null";s.className+=" root_item";this.root_item=s}e.INDENT=20;e.prototype.updateTree=function(e){this.root.innerHTML="";var t=this.createAndInsert(e,this.options,null);if(t){t.className+=" root_item";this.root_item=t}else this.root_item=null};e.prototype.insertItem=function(e,t,i,n){if(!t){var r=this.root.childNodes[0];if(r)t=r.dataset["item_id"]}var o=this.createAndInsert(e,n,t,i);if(t)this._updateListBox(this._findElement(t));return o};e.prototype.createAndInsert=function(e,t,i,n){var r=-1;if(i)r=this._findElementIndex(i);else if(i===undefined)r=0;var o=null;var s=0;if(r!=-1){o=this.root.childNodes[r];s=parseInt(o.dataset["level"])+1}var a=this.createTreeItem(e,t,s);if(!a)return;a.parent_id=i;var l=this.getItem(a.dataset["item_id"]);if(l)console.warn("There another item with the same ID in this tree");if(r==-1)this.root.appendChild(a);else this._insertInside(a,r,n);if(o&&!this._isNodeChildrenVisible(i))a.classList.add("hidden");if(e.children){for(var c=0;c<e.children.length;++c){this.createAndInsert(e.children[c],t,e.id)}}this._updateListBox(a,t,s);if(t&&t.selected)this.markAsSelected(a,true);return a};e.prototype._insertInside=function(t,i,n,r){var o=this.root.childNodes[i];if(!o)throw"No parent node found, index: "+i+", nodes: "+this.root.childNodes.length;var s=parseInt(o.dataset["level"]);var a=r!==undefined?r:s+1;var l=t.querySelector(".indentblock");if(l)l.style.paddingLeft=(a+this.indent_offset)*e.INDENT+"px";t.dataset["level"]=a;for(var c=i+1;c<this.root.childNodes.length;++c){var u=this.root.childNodes[c];if(!u.classList||!u.classList.contains("ltreeitem"))continue;var d=parseInt(u.dataset["level"]);if(d==a&&n){n--;continue}if(d<a||n===0&&d===a){this.root.insertBefore(t,u);return}}this.root.appendChild(t)};e.prototype._isNodeChildrenVisible=function(e){var t=this.getItem(e);if(!t)return false;if(t.classList.contains("hidden"))return false;var i=t.querySelector(".listbox");if(!i)return true;if(i.getValue()=="closed")return false;return true};e.prototype._findElement=function(e){if(!e||e.constructor!==String)throw"findElement param must be string with item id";for(var t=0;t<this.root.childNodes.length;++t){var i=this.root.childNodes[t];if(!i.classList||!i.classList.contains("ltreeitem"))continue;if(i.classList.contains("ltreeitem-"+e))return i}return null};e.prototype._findElementIndex=function(e){for(var t=0;t<this.root.childNodes.length;++t){var i=this.root.childNodes[t];if(!i.classList||!i.classList.contains("ltreeitem"))continue;if(typeof e==="string"){if(i.dataset["item_id"]===e)return t}else if(i===e)return t}return-1};e.prototype._findElementLastChildIndex=function(e){if(e==-1)return-1;var t=parseInt(this.root.childNodes[e].dataset["level"]);for(var i=e+1;i<this.root.childNodes.length;++i){var n=this.root.childNodes[i];if(!n.classList||!n.classList.contains("ltreeitem"))continue;var r=parseInt(n.dataset["level"]);if(r==t)return i}return-1};e.prototype._findChildElements=function(e,t){var i=this._findElementIndex(e);if(i==-1)return;var n=this.root.childNodes[i];var r=parseInt(n.dataset["level"]);var o=[];for(var s=i+1;s<this.root.childNodes.length;++s){var a=this.root.childNodes[s];if(!a.classList||!a.classList.contains("ltreeitem"))continue;var l=parseInt(a.dataset["level"]);if(t&&l>r+1)continue;if(l<=r)return o;o.push(a)}return o};e.prototype.createTreeItem=function(e,t,i){if(e===null||e===undefined){console.error("Tree item cannot be null");return}t=t||this.options;var n=document.createElement("li");n.className="ltreeitem";var r=this;if(e.id){var o=e.id.replace(/\s/g,"_");n.className+=" ltreeitem-"+o;n.dataset["item_id"]=e.id}if(e.dataset)for(var s in e.dataset)n.dataset[s]=e.dataset[s];e.DOM=n;n.data=e;if(i!==undefined){n.dataset["level"]=i;n.classList.add("ltree-level-"+i)}var a=document.createElement("div");a.className="ltreeitemtitle";if(e.className)a.className+=" "+e.className;a.innerHTML="<span class='precontent'></span><span class='indentblock'></span><span class='collapsebox'></span><span class='incontent'></span><span class='postcontent'></span>";var l=e.content||e.id||"";a.querySelector(".incontent").innerHTML=l;if(e.precontent)a.querySelector(".precontent").innerHTML=e.precontent;if(e.postcontent)a.querySelector(".postcontent").innerHTML=e.postcontent;if(e.dataset)for(var s in e.dataset)n.dataset[s]=e.dataset[s];n.appendChild(a);n.title_element=a;if(e.visible===false)n.style.display="none";var c=n;c.addEventListener("click",u);c.addEventListener("dblclick",d);c.addEventListener("contextmenu",function(e){var t=this;e.preventDefault();e.stopPropagation();if(e.button!=2)return;if(r.onItemContextMenu)return r.onItemContextMenu(e,{item:t,data:t.data});return false});function u(t){t.preventDefault();t.stopPropagation();var i=this;var n=i.title_element;if(n._editing)return;if(t.ctrlKey&&r.options.allow_multiselection){if(r.isNodeSelected(i)){i.classList.remove("selected");vjgui.trigger(r,"item_remove_from_selection",{item:i,data:i.data});vjgui.trigger(r.root,"item_remove_from_selection",{item:i,data:i.data});return}r.markAsSelected(i,true);vjgui.trigger(r,"item_add_to_selection",{item:i,data:i.data});vjgui.trigger(r.root,"item_add_to_selection",{item:i,data:i.data});var o=false;if(e.callback)o=e.callback.call(r,i);if(!o&&r.onItemAddToSelection)r.onItemAddToSelection(i.data,i)}if(t.shiftKey&&r.options.allow_multiselection){var s=r.getSelectedItem();if(!s)return;if(s===i)return;var a=Array.prototype.slice.call(s.parentNode.children);var l=a.indexOf(s);var c=a.indexOf(i);var u=c>l?a.slice(l,c):a.slice(c,l);for(var d=0;d<u.length;++d){var h=u[d];r.markAsSelected(h,true);vjgui.trigger(r,"item_add_to_selection",{item:h,data:h.data});vjgui.trigger(r.root,"item_add_to_selection",{item:h,data:h.data})}}else{r.markAsSelected(i);r._skip_scroll=true;vjgui.trigger(r,"item_selected",{item:i,data:i.data});vjgui.trigger(r.root,"item_selected",{item:i,data:i.data});var o=false;if(e.callback)o=e.callback.call(r,i);if(!o&&r.onItemSelected)r.onItemSelected(i.data,i);r._skip_scroll=false}}function d(e){var t=this;var i=t.title_element.querySelector(".incontent");vjgui.trigger(r,"item_dblclicked",t);vjgui.trigger(r.root,"item_dblclicked",t);if(!i._editing&&r.options.allow_rename){i._editing=true;i._old_name=i.innerHTML;var n=i;i.innerHTML="<input type='text' value='"+i.innerHTML+"' />";var o=i.querySelector("input");o.addEventListener("blur",function(e){var i=e.target.value;setTimeout(function(){n.innerHTML=i},1);delete n._editing;vjgui.trigger(r.root,"item_renamed",{old_name:n._old_name,new_name:i,item:t,data:t.data});delete n._old_name});o.addEventListener("keydown",function(e){if(e.keyCode!=13)return;this.blur()});o.focus();e.preventDefault()}e.preventDefault();e.stopPropagation()}var h=a;if(this.options.allow_drag){h.draggable=true;h.addEventListener("dragstart",function(t){t.dataTransfer.setData("item_id",this.parentNode.dataset["item_id"]);if(!e.onDragData)return;var i=e.onDragData();if(i){for(var n in i)t.dataTransfer.setData(n,i[n])}})}var f=0;h.addEventListener("dragenter",function(t){t.preventDefault();if(e.skipdrag)return false;if(f==0)a.classList.add("dragover");f++});h.addEventListener("dragleave",function(e){e.preventDefault();f--;if(f==0)a.classList.remove("dragover")});h.addEventListener("dragover",p);function p(e){e.preventDefault()}h.addEventListener("drop",function(t){a.classList.remove("dragover");t.preventDefault();if(e.skipdrag)return false;var i=t.dataTransfer.getData("item_id");if(!i){vjgui.trigger(r.root,"drop_on_item",{item:this,event:t});if(r.onDropItem)r.onDropItem(t,this.parentNode.data);return}{var n=this.parentNode.dataset["item_id"];if(!r.onMoveItem||r.onMoveItem&&r.onMoveItem(r.getItem(i),r.getItem(n))!=false){if(r.moveItem(i,n))vjgui.trigger(r.root,"item_moved",{item:r.getItem(i),parent_item:r.getItem(n)})}}if(r.onDropItem)r.onDropItem(t,this.parentNode.data)});return n};e.prototype.filterByName=function(t){for(var i=0;i<this.root.childNodes.length;++i){var n=this.root.childNodes[i];if(!n.classList||!n.classList.contains("ltreeitem"))continue;var r=n.querySelector(".incontent");if(!r)continue;var o=r.innerHTML.toLowerCase();if(!t||o.indexOf(t.toLowerCase())!=-1){if(n.data&&n.data.visible!==false)n.classList.remove("filtered");var s=n.querySelector(".indentblock");if(s){if(t)s.style.paddingLeft=0;else s.style.paddingLeft=paddingLeft=(parseInt(n.dataset["level"])+this.indent_offset)*e.INDENT+"px"}}else{n.classList.add("filtered")}}};e.prototype.filterByRule=function(e,t){if(!e)throw"filterByRule requires a callback";for(var i=0;i<this.root.childNodes.length;++i){var n=this.root.childNodes[i];if(!n.classList||!n.classList.contains("ltreeitem"))continue;var r=n.querySelector(".incontent");if(!r)continue;if(e(n.data,r,t)){if(n.data&&n.data.visible!==false)n.classList.remove("filtered");var o=n.querySelector(".indentblock");if(o){if(name)o.style.paddingLeft=0;else o.style.paddingLeft=paddingLeft=(parseInt(n.dataset["level"])+this.indent_offset)*vjgui.Tree.INDENT+"px"}}else{n.classList.add("filtered")}}};e.prototype.getItem=function(e){if(!e)return null;if(e.classList)return e;for(var t=0;t<this.root.childNodes.length;++t){var i=this.root.childNodes[t];if(!i.classList||!i.classList.contains("ltreeitem"))continue;if(i.dataset["item_id"]===e)return i}return null};e.prototype.expandItem=function(e,t){var i=this.getItem(e);if(!i)return;if(!i.listbox)return;i.listbox.setValue(true);if(!t)return;var n=this.getParent(i);if(n)this.expandItem(n,t)};e.prototype.collapseItem=function(e){var t=this.getItem(e);if(!t)return;if(!t.listbox)return;listbox.setValue(false)};e.prototype.isInsideArea=function(e){var t=e.constructor===String?this.getItem(e):e;if(!t)return false;var i=this.root.getClientRects();if(!i.length)return false;var n=i[0];var r=n.height;var o=t.offsetTop;if(this.root.scrollTop<o&&o<this.root.scrollTop+r)return true;return false};e.prototype.scrollToItem=function(t){var i=t.constructor===String?this.getItem(t):t;if(!i)return;var n=this.root.parentNode;if(!n)return;var r=n.getBoundingClientRect();if(!r)return;var o=r.height;var s=(parseInt(i.dataset["level"])+this.indent_offset)*e.INDENT+50;n.scrollTop=i.offsetTop-o*.5|0;if(r.width*.75<s)n.scrollLeft=s;else n.scrollLeft=0};e.prototype.setSelectedItem=function(e,t,i){if(!e){this.unmarkAllAsSelected();return}var n=this.getItem(e);if(!n)return null;if(n.classList.contains("selected"))return;this.markAsSelected(n);if(t&&!this._skip_scroll)this.scrollToItem(n);this.expandItem(n,true);if(i)vjgui.trigger(n,"click");return n};e.prototype.addItemToSelection=function(e){if(!e)return;var t=this.getItem(e);if(!t)return null;this.markAsSelected(t,true);return t};e.prototype.removeItemFromSelection=function(e){if(!e)return;var t=this.getItem(e);if(!t)return null;t.classList.remove("selected")};e.prototype.getSelectedItem=function(){return this.root.querySelector(".ltreeitem.selected")};e.prototype.getSelectedItems=function(){return this.root.querySelectorAll(".ltreeitem.selected")};e.prototype.isItemSelected=function(e){var t=this.getItem(e);if(!t)return false;return this.isNodeSelected(t)};e.prototype.getChildren=function(e,t){if(e&&e.constructor!==String&&e.dataset)e=e.dataset["item_id"];return this._findChildElements(e,t)};e.prototype.getParent=function(e){var t=this.getItem(e);if(t)return this.getItem(t.parent_id);return null};e.prototype.getAncestors=function(e,t){t=t||[];var i=this.getItem(e);if(i){t.push(i);return this.getAncestors(i.parent_id,t)}return t};e.prototype.isAncestor=function(e,t){var i=this.getItem(e);if(!i)return false;var n=this.getItem(t);var r=this.getItem(i.parent_id);if(!r)return false;if(r==n)return true;return this.isAncestor(r,t)};e.prototype.moveItem=function(e,t){if(e===t)return false;var i=this.getItem(e);var n=this.getItem(t);if(this.isAncestor(n,i))return false;var r=this._findElementIndex(n);var o=parseInt(n.dataset["level"]);var s=this.getParent(i);if(!s){console.error("node parent not found by id, maybe id has changed");return false}var a=parseInt(s.dataset["level"]);var l=o-a;if(!n||!i)return false;if(n==s)return false;i.parent_id=t;var c=this.getChildren(i);if(c){c.unshift(i);for(var u=0;u<c.length;u++)c[u].parentNode.removeChild(c[u]);for(var u=0;u<c.length;u++){var d=c[u];var h=parseInt(d.dataset["level"])+l;d.dataset["level"]=h}r=this._findElementIndex(n);var f=this._findElementLastChildIndex(r);if(f==-1)f=0;for(var u=0;u<c.length;u++){var d=c[u];this._insertInside(d,r,f+u-1,parseInt(d.dataset["level"]))}}this._updateListBox(n);if(s)this._updateListBox(s);return true};e.prototype.removeItem=function(e,t){var i=e;if(typeof e=="string")i=this.getItem(e);if(!i)return false;var n=this.getParent(i);var r=null;if(t)r=this.getChildren(i);this.root.removeChild(i);if(r){for(var o=0;o<r.length;o++)this.root.removeChild(r[o])}if(n)this._updateListBox(n);return true};e.prototype.updateItem=function(e,t){var i=this.getItem(e);if(!i)return false;i.data=t;if(t.id)i.id=t.id;if(t.content){var n=i.title_element.querySelector(".incontent");n.innerHTML=t.content}return true};e.prototype.updateItemId=function(e,t){var i=this.getItem(e);if(!i)return false;var n=this.getChildren(e,true);i.id=t;for(var r=0;r<n.length;++r){var o=n[r];o.parent_id=t}return true};e.prototype.clear=function(e){if(!e){this.root.innerHTML="";return}var t=this.root.querySelectorAll(".ltreeitem");for(var i=1;i<t.length;i++){var n=t[i];this.root.removeChild(n)}};e.prototype.getNodeByIndex=function(e){var t=this.root.querySelectorAll(".ltreeitem");return t[e]};e.prototype.unmarkAllAsSelected=function(){this.root.classList.remove("selected");var e=this.root.querySelectorAll(".ltreeitem.selected");if(e){for(var t=0;t<e.length;t++)e[t].classList.remove("selected")}var i=this.root.querySelectorAll(".ltreeitem.semiselected");for(var t=0;t<i.length;t++)i[t].classList.remove("semiselected")};e.prototype.isNodeSelected=function(e){if(e.classList.contains("selected"))return true;return false};e.prototype.markAsSelected=function(e,t){if(e.classList.contains("selected"))return;if(!t)this.unmarkAllAsSelected();e.classList.add("selected");var i=this.getParent(e);var n=[];while(i&&n.indexOf(i)==-1){i.classList.add("semiselected");n.push(i);i=this.getParent(i)}};e.prototype._updateListBox=function(e,t,i){if(!e)return;var n=this;if(!e.listbox){var r=e.title_element.querySelector(".collapsebox");var o=vjgui.createLitebox(true,function(t){n.onClickBox(t,e);vjgui.trigger(n.root,"item_collapse_change",{item:e,data:o.getValue()})});o.stopPropagation=true;o.setEmpty(true);r.appendChild(o);e.listbox=o}if(t&&t.collapsed||i>=this.collapsed_depth)e.listbox.collapse();var s=this.getChildren(e.dataset["item_id"]);if(!s)return;if(s.length)e.listbox.setEmpty(false);else e.listbox.setEmpty(true)};e.prototype.onClickBox=function(e,t){var i=this.getChildren(t);if(!i)return;for(var n=0;n<i.length;++n){var r=i[n];var o=this.getParent(r);var s=true;if(o)s=this._isNodeChildrenVisible(o);if(s)r.classList.remove("hidden");else r.classList.add("hidden")}};vjgui.Tree=e})();(function(){function e(e,t){this._ctor(e,t)}e.title_height="20px";e.prototype._ctor=function(e,t){if(!t&&e&&e.constructor!==String){t=e;e=null}t=t||{};this.content=t.content||"";var i=this.root=document.createElement("div");if(e)i.id=e;i.className="vjpanel "+(t.className||"");i.data=this;var n="";if(t.title)n+="<div class='panel-header'>"+t.title+"</div>";n+="<div class='content'>"+this.content+"</div>";n+="<div class='panel-footer'></div>";i.innerHTML=n;if(t.title)this.header=this.root.querySelector(".panel-header");this.content=this.root.querySelector(".content");this.footer=this.root.querySelector(".panel-footer");if(t.width)this.root.style.width=vjgui.sizeToCSS(t.width);if(t.height)this.root.style.height=vjgui.sizeToCSS(t.height);if(t.position){this.root.style.position="absolute";this.root.style.left=vjgui.sizeToCSS(t.position[0]);this.root.style.top=vjgui.sizeToCSS(t.position[1])}if(t.scroll==true)this.content.style.overflow="auto"};e.prototype.add=function(e){this.content.appendChild(e.root)};e.prototype.clear=function(){while(this.content.firstChild)this.content.removeChild(this.content.firstChild)};vjgui.Panel=e})();(function(){function e(e,t){if(t||e&&e.constructor===String){var i=e;e=t||{};e.id=i;console.warn("vjgui.Dialog legacy parameter, use options as first parameter instead of id.")}this._ctor(e)}e.MINIMIZED_WIDTH=200;e.title_height="20px";e.getDialog=function(e){var t=document.getElementById(e);if(!t)return null;return t.dialog};e.prototype._ctor=function(t){t=t||{};var i=this;this.width=t.width;this.height=t.height;this.minWidth=t.minWidth||150;this.minHeight=t.minHeight||100;this.content=t.content||"";var n=document.createElement("div");if(t.id)n.id=t.id;n.className="vjdialog "+(t.className||"");n.data=this;n.dialog=this;var r="";if(t.title){r+="<div class='panel-header'>"+t.title+"</div><div class='buttons'>";if(t.minimize){r+="<button class='vjbutton mini-button minimize-button'>-</button>";r+="<button class='vjbutton mini-button maximize-button' style='display:none'></button>"}if(t.hide)r+="<button class='vjbutton mini-button hide-button'></button>";if(t.detachable)r+="<button class='vjbutton mini-button detach-button'></button>";if(t.close||t.closable)r+="<button class='vjbutton mini-button close-button'>"+vjgui.special_codes.close+"</button>";r+="</div>"}r+="<div class='content'>"+this.content+"</div>";r+="<div class='panel-footer'></div>";n.innerHTML=r;this.root=n;this.content=n.querySelector(".content");this.footer=n.querySelector(".panel-footer");if(t.fullcontent){this.content.style.width="100%";this.content.style.height=t.title?"calc( 100% - "+e.title_height+" )":"100%"}if(t.buttons){for(var o in t.buttons)this.addButton(t.buttons[o].name,t.buttons[o])}if(t.scroll==true)this.content.style.overflow="auto";var s=n.querySelector(".close-button");if(s)s.addEventListener("click",this.close.bind(this));var a=n.querySelector(".maximize-button");if(a)a.addEventListener("click",this.maximize.bind(this));var l=n.querySelector(".minimize-button");if(l)l.addEventListener("click",this.minimize.bind(this));var c=n.querySelector(".hide-button");if(c)c.addEventListener("click",this.hide.bind(this));var u=n.querySelector(".detach-button");if(u)u.addEventListener("click",function(){i.detachWindow()});this.enableProperties(t);this.root.addEventListener("DOMNodeInsertedIntoDocument",function(){if(i.on_attached_to_DOM)i.on_attached_to_DOM();if(i.on_resize)i.on_resize()});this.root.addEventListener("DOMNodeRemovedFromDocument",function(){if(i.on_detached_from_DOM)i.on_detached_from_DOM()});if(t.attach||t.parent){var d=null;if(t.parent)d=typeof t.parent=="string"?document.querySelector(t.parent):t.parent;if(!d)d=vjgui.root;d.appendChild(this.root);this.center()}};e.prototype.add=function(e){this.content.appendChild(e.root||e)};e.prototype.enableProperties=function(e){e=e||{};var t=this;var i=this.root;i.style.position="absolute";i.style.minWidth=this.minWidth+"px";i.style.minHeight=this.minHeight+"px";if(this.width)i.style.width=this.width+"px";if(this.height){if(typeof this.height=="number"){i.style.height=this.height+"px"}else{if(this.height.indexOf("%")!=-1)i.style.height=this.height}this.content.style.height="calc( "+this.height+"px - 24px )"}i.style.boxShadow="0 0 3px black";if(e.draggable){this.draggable=true;vjgui.draggable(i,i.querySelector(".panel-header"),function(){t.bringToFront()},null,function(){return!t.minimized})}if(e.resizable)this.setResizable()};e.prototype.setResizable=function(){if(this.resizable)return;var e=this.root;this.resizable=true;var t=this.footer;t.style.minHeight="4px";t.classList.add("resizable");var i=document.createElement("div");i.className="resizable-corner";this.root.appendChild(i);t.addEventListener("mousedown",s);i.addEventListener("mousedown",s,true);var n=[0,0];var r=this;var o=false;function s(t){if(t.type=="mousedown"){document.body.addEventListener("mousemove",s);document.body.addEventListener("mouseup",s);o=this==i;n[0]=t.pageX;n[1]=t.pageY}else if(t.type=="mousemove"){var a=vjgui.getRect(e);var l=a.width;var c=l-(n[0]-t.pageX);var u=a.height;var d=u-(n[1]-t.pageY);if(o)e.style.width=c+"px";e.style.height=d+"px";n[0]=t.pageX;n[1]=t.pageY;r.content.style.height="calc( 100% - 24px )";if(r.on_resize&&(l!=c||u!=d))r.on_resize(t,c,d)}else if(t.type=="mouseup"){document.body.removeEventListener("mousemove",s);document.body.removeEventListener("mouseup",s);o=false}t.preventDefault();t.stopPropagation();return false}};e.prototype.dockTo=function(e,t){if(!e)return;var i=this.root;t=t||"full";e=e.content||e;i.style.top=0;i.style.left=0;i.style.boxShadow="0 0 0";if(t=="full"){i.style.position="relative";i.style.width="100%";i.style.height="100%";this.content.style.width="100%";this.content.style.height="calc(100% - "+vjgui.Panel.title_height+")";this.content.style.overflow="auto"}else if(t=="left"||t=="right"){i.style.position="absolute";i.style.top=0;i.style[t]=0;i.style.width=this.width+"px";i.style.height="100%";this.content.style.height="calc(100% - "+vjgui.Panel.title_height+")";this.content.style.overflow="auto";if(t=="right"){i.style.left="auto";i.style.right=0}}else if(t=="bottom"||t=="top"){i.style.width="100%";i.style.height=this.height+"px";if(t=="bottom"){i.style.bottom=0;i.style.top="auto"}}if(this.draggable){vjgui.draggable(i)}if(e.content)e.content.appendChild(i);else if(typeof e=="string"){e=document.querySelector(e);if(e)e.appendChild(i)}else e.appendChild(i)};e.prototype.addButton=function(e,t){t=t||{};if(t.constructor===Function)t={callback:t};var i=this;var n=document.createElement("button");n.className="vjbutton";n.innerHTML=e;if(t.className)n.className+=" "+t.className;this.root.querySelector(".panel-footer").appendChild(n);n.addEventListener("click",function(e){if(t.callback)t.callback(this);if(t.close)i.close()});return n};e.prototype.close=function(){vjgui.remove(this.root);vjgui.trigger(this,"closed",this);if(this.on_close)this.on_close();if(this.onclose)console.warn("Dialog: Do not use onclose, use on_close instead");if(this.dialog_window){this.dialog_window.close();this.dialog_window=null}};e.prototype.highlight=function(e){e=e||100;this.root.style.outline="1px solid white";var t=this.root.ownerDocument;var i=t.defaultView||t.parentWindow;i.focus();setTimeout(function(){this.root.style.outline=null}.bind(this),e)};e.minimized=[];e.prototype.minimize=function(){if(this.minimized)return;this.minimized=true;this.old_box=this.root.getBoundingClientRect();this.root.querySelector(".content").style.display="none";var e=this.root.querySelector(".minimize-button");if(e)e.style.display="none";var t=this.root.querySelector(".maximize-button");if(t)t.style.display="";this.root.style.width=vjgui.Dialog.MINIMIZED_WIDTH+"px";vjgui.bind(this,"closed",function(){vjgui.Dialog.minimized.splice(vjgui.Dialog.minimized.indexOf(this),1);vjgui.Dialog.arrangeMinimized()});vjgui.Dialog.minimized.push(this);vjgui.Dialog.arrangeMinimized();vjgui.trigger(this,"minimizing")};e.arrangeMinimized=function(){for(var e in vjgui.Dialog.minimized){var t=vjgui.Dialog.minimized[e];var i=t.root.parentNode;var n=i.getBoundingClientRect().height-20;t.root.style.left=vjgui.Dialog.MINIMIZED_WIDTH*e;t.root.style.top=n+"px"}};e.prototype.maximize=function(){if(!this.minimized)return;this.minimized=false;this.root.querySelector(".content").style.display="";vjgui.draggable(this.root);this.root.style.left=this.old_box.left+"px";this.root.style.top=this.old_box.top+"px";this.root.style.width=this.old_box.width+"px";this.root.style.height=this.old_box.height+"px";var e=this.root.querySelector(".minimize-button");if(e)e.style.display="";var t=this.root.querySelector(".maximize-button");if(t)t.style.display="none";vjgui.Dialog.minimized.splice(vjgui.Dialog.minimized.indexOf(this),1);vjgui.Dialog.arrangeMinimized();vjgui.trigger(this,"maximizing")};e.prototype.makeModal=function(){vjgui.showModalBackground(true);vjgui.modalbg_div.appendChild(this.root);this.show();this.center();vjgui.bind(this,"closed",e);function e(e){vjgui.showModalBackground(false)}};e.prototype.bringToFront=function(){var e=this.root.parentNode;e.removeChild(this.root);e.appendChild(this.root)};e.prototype.show=function(e,t){if(!this.root.parentNode){if(!t)vjgui.add(this);else{var i=t.ownerDocument;var n=i.querySelector(".vjgui-wrap")||i.body;n.appendChild(this.root);var r=i.defaultView||i.parentWindow;r.focus()}this.center()}if(!this.detach_window){this.root.style.display="";vjgui.trigger(this,"shown")}};e.prototype.hide=function(e){this.root.style.display="none";vjgui.trigger(this,"hidden")};e.prototype.fadeIn=function(e){e=e||1e3;this.root.style.display="";this.root.style.opacity=0;var t=this;setTimeout(function(){t.root.style.transition="opacity "+e+"ms";t.root.style.opacity=1},100)};e.prototype.setPosition=function(e,t){if(!this.root.parentNode)console.warn("vjgui.Dialog: Cannot set position of dialog if it is not in the DOM");this.root.position="absolute";this.root.style.left=e+"px";this.root.style.top=t+"px"};e.prototype.setSize=function(e,t){this.root.style.width=typeof e=="number"?e+"px":e;this.root.style.height=typeof t=="number"?t+"px":t};e.prototype.setTitle=function(e){if(!this.header)return;this.header.innerHTML=e};e.prototype.center=function(){if(!this.root.parentNode)return;this.root.position="absolute";var e=this.root.offsetWidth;var t=this.root.offsetHeight;var i=this.root.parentNode.offsetWidth;var n=this.root.parentNode.offsetHeight;this.root.style.left=Math.floor((i-e)*.5)+"px";this.root.style.top=Math.floor((n-t)*.5)+"px"};e.prototype.adjustSize=function(e,t){e=e||0;this.content.style.height="auto";if(this.content.offsetHeight==0&&!t){var i=this;setTimeout(function(){i.adjustSize(e,true)},1);return}var n=0;var r=this.root.querySelector(".panel-footer");if(r)n+=r.offsetHeight;var o=this.content.offsetWidth;var s=this.content.offsetHeight+20+e+n;this.setSize(o,s)};e.prototype.clear=function(){this.content.innerHTML=""};e.prototype.detachWindow=function(e,t){if(this.dialog_window)return;var i=this.root.getClientRects()[0];var n=i.width;var r=i.height;var o="Window";var s=this.root.querySelector(".panel-header");if(s)o=s.textContent;var a=window.open("","","width="+n+", height="+r+", location=no, status=no, menubar=no, titlebar=no, fullscreen=yes");a.document.write("<head><title>"+o+"</title>");this.dialog_window=a;var l=document.querySelectorAll("link[rel='stylesheet'],style");for(var c=0;c<l.length;c++)a.document.write(l[c].outerHTML);a.document.write("</head><body></body>");a.document.close();var u=this;a.onbeforeunload=function(){var e=vjgui.windows.indexOf(a);if(e!=-1)vjgui.windows.splice(e,1);if(t)t()};a.document.body.appendChild(this.content);this.root.style.display="none";this._old_height=this.content.style.height;this.content.style.height="100%";vjgui.windows.push(a);if(e)e();return a};e.prototype.reattachWindow=function(e){if(!this.dialog_window)return;this.root.appendChild(this.content);this.root.style.display="";this.content.style.height=this._old_height;delete this._old_height;this.dialog_window.close();var t=vjgui.windows.indexOf(this.dialog_window);if(t!=-1)vjgui.windows.splice(t,1);this.dialog_window=null};e.showAll=function(){var e=document.body.querySelectorAll("vjdialog");for(var t=0;t<e.length;t++){var i=e[t];i.dialog.show()}};e.hideAll=function(){var e=document.body.querySelectorAll("vjdialog");for(var t=0;t<e.length;t++){var i=e[t];i.dialog.hide()}};e.closeAll=function(){var e=document.body.querySelectorAll("vjdialog");for(var t=0;t<e.length;t++){var i=e[t];i.dialog.close()}};vjgui.Dialog=e})();(function(){function e(e){e=e||{};this.root=document.createElement("table");this.root.classList.add("vjtable");this.columns=[];this.column_fields=[];this.rows=[];this.data=[];this._must_update_header=true;if(e.colums)this.setColumns(e.colums);if(e.scrollable)this.root.style.overflow="auto";if(e.height)this.root.style.height=vjgui.sizeToCSS(e.height);if(e.columns)this.setColumns(e.columns);if(e.rows)this.setRows(e.data)}e.prototype.setRows=function(e,t){this.data=e;this.updateContent(t)};e.prototype.addRow=function(e,t){var i=document.createElement("tr");for(var n=0;n<this.column_fields.length;++n){var r=document.createElement("td");var o=null;if(e.constructor===Array)o=e[n];else o=e[this.column_fields[n]];if(o===undefined)o="";r.innerHTML=o;var s=this.columns[n];if(s===undefined)break;if(s.className)r.className=s.className;if(s.width)r.style.width=s.width;i.appendChild(r)}this.root.appendChild(i);this.rows.push(i);if(!t)this.data.push(e);return i};e.prototype.updateRow=function(e,t){this.data[e]=t;var i=this.rows[e];if(!i)return;var n=i.querySelectorAll("td");for(var r=0;r<n.length;++r){var o=this.columns[r];var s=null;if(t.constructor===Array)s=t[r];else s=t[o.field];if(s===undefined)s="";n[r].innerHTML=s}return i};e.prototype.updateCell=function(e,t,i){var n=this.rows[e];if(!n)return;var t=n.childNodes[t];if(!t)return;t.innerHTML=i;return t};e.prototype.setColumns=function(e){this.columns.length=0;this.column_fields.length=0;var t=Math.floor(100/e.length).toFixed(1)+"%";var i=[];for(var n=0;n<e.length;++n){var r=e[n];if(r===null||r===undefined)continue;if(r.constructor===String||r.constructor===Number)r={name:String(r)};var o={name:r.name||"",width:vjgui.sizeToCSS(r.width||t),field:(r.field||r.name||"").toLowerCase(),className:r.className};if(n==e.length-1)o.width=" calc( 100% - ( "+i.join(" + ")+" ) )";else i.push(o.width);this.columns.push(o);this.column_fields.push(o.field)}this._must_update_header=true;this.updateContent()};e.prototype.updateContent=function(e){this.root.innerHTML="";if(this._must_update_header){this.header=document.createElement("tr");for(var t=0;t<this.columns.length;++t){var i=this.columns[t];var n=document.createElement("th");n.innerHTML=i.name;if(i.width)n.style.width=i.width;i.th=n;this.header.appendChild(n)}this._must_update_header=false}this.root.appendChild(this.header);if(!this.data)return;if(this.data.length!=this.rows.length)e=false;if(e){for(var t=0;t<this.rows.length;++t){var r=this.data[t];var o=this.updateRow(t,r);this.root.appendChild(o)}}else{this.rows.length=0;for(var t=0;t<this.data.length;++t){var s=this.data[t];this.addRow(s,true)}}};vjgui.Table=e})();function Inspector(e){if(e&&e.constructor===String){var t=e;e=arguments[1]||{};e.id=t;console.warn("vjgui.Inspector legacy parameter, use options as first parameter instead of id.")}e=e||{};this.root=document.createElement("DIV");this.root.className="inspector "+(e.full?"full":"")+(e.className||"");if(e.one_line){this.one_line=true;this.root.className+=" one_line"}if(e.id)this.root.id=e.id;this.sections=[];this.values={};this.widgets=[];this.widgets_by_name={};this.row_number=0;this.addContainer();this.tab_index=Math.floor(Math.random()*1e4);if(e.width)this.root.style.width=vjgui.sizeToCSS(e.width);if(e.height){this.root.style.height=vjgui.sizeToCSS(e.height);if(!e.one_line)this.root.style.overflow="auto"}if(e.name_width)this.name_width=e.name_width;if(e.widgets_width)this.widgets_width=e.widgets_width;if(e.noscroll)this.root.style.overflow="hidden";if(e.onchange)this.onchange=e.onchange;if(e.parent)this.appendTo(e.parent);this.className=this.root.className;this.widgets_per_row=e.widgets_per_row||1}Inspector.prototype.getValues=function(){var e={};for(var t in this.widgets_by_name)e[t]=this.widgets_by_name[t].getValue();return e};Inspector.prototype.setValues=function(e){for(var t in e)if(this.widgets_by_name[t])this.widgets_by_name[t].setValue(e[t])};Inspector.prototype.appendTo=function(e,t){if(!e)return;if(e.constructor===String)e=document.querySelector(e);if(!e)return;if(t)e.insertBefore(this.root,e.firstChild);else e.appendChild(this.root)};Inspector.prototype.clear=function(){purgeElement(this.root,true);while(this.root.hasChildNodes())this.root.removeChild(this.root.lastChild);this.root.className=this.className;this.row_number=0;this.values={};this.widgets=[];this.widgets_by_name={};this.sections=[];this.current_section=null;this._current_container=null;this._current_container_stack=null;this.addContainer()};Inspector.prototype.refresh=function(){if(this.on_refresh)this.on_refresh()};Inspector.prototype.append=function(e,t){t=t||{};var i=t.widget_parent||this._current_container||this.root;if(t.replace)t.replace.parentNode.replaceChild(e,t.replace);else{e.section=this.current_section;i.appendChild(e)}};Inspector.prototype.pushContainer=function(e){if(!this._current_container_stack)this._current_container_stack=[e];else{if(this._current_container_stack.indexOf(e)!=-1){console.warn("Container already in the stack");return}this._current_container_stack.push(e)}this._current_container=e};Inspector.prototype.isContainerInStack=function(e){if(!this._current_container_stack)return false;if(this._current_container_stack.indexOf(e)!=-1)return true;return false};Inspector.prototype.popContainer=function(e){this.row_number=0;if(this._current_container_stack&&this._current_container_stack.length){if(e){var t=this._current_container_stack.pop();while(t&&t!=e)t=this._current_container_stack.pop()}else{this._current_container_stack.pop()}this._current_container=this._current_container_stack[this._current_container_stack.length-1]}else this._current_container=null};Inspector.prototype.setup=function(e){for(var t in e){var i=e[t];var n=this.add(i.type,i.name,i.value,i.options)}};Inspector.prototype.getWidget=function(e){if(e!==null&&e.constructor===Number)return this.widgets[e];return this.widgets_by_name[e]};Inspector.prototype.inspectInstance=function(e,t,i,n){if(!e)return;if(!t){if(e.getProperties)t=e.getProperties();else t=this.collectProperties(e)}else{}var r=e.constructor;if(!i&&r.properties)i=r.properties;var o={};if(e.getInspectorProperties)o=e.getInspectorProperties();else{for(var s in t){if(i&&i[s]){o[s]=h(i[s]);continue}var a=t[s];if(r["@"+s]){var l=r["@"+s];if(l&&l.widget===null)continue;o[s]=h(l)}else if(e["@"+s])o[s]=e["@"+s];else if(a===null||a===undefined)continue;else{switch(a.constructor){case Number:o[s]={type:"number",step:.1};break;case String:o[s]={type:"string"};break;case Boolean:o[s]={type:"boolean"};break;default:if(a&&(a.constructor===Array||a.constructor.BYTES_PER_ELEMENT)){var c=a[0]!=null&&a[0].constructor===Number;switch(a.length){case 2:o[s]={type:c?"vec2":"Array",step:.1};break;case 3:o[s]={type:c?"vec3":"Array",step:.1};break;case 4:o[s]={type:c?"vec4":"Array",step:.1};break;default:o[s]={type:"Array"};break;continue}}}}}}if(n)for(var s in n)delete o[n[s]];if(r.properties_order){var u={};for(var s in r.properties_order){var d=r.properties_order[s];if(o[d])u[d]=o[d];else console.warn("property not found in instance:",d)}for(var s in o){if(!u[s])u[s]=o[s]}o=u}return this.showProperties(e,o);function h(e,t){t=t||{};for(var i in e)t[i]=e[i];return t}};Inspector.prototype.collectProperties=function(e){var t={};for(var i in e){if(i[0]=="_"||i[0]=="@"||i.substr(0,6)=="jQuery")continue;var n=e[i];if(n&&n.constructor==Function&&!e.constructor["@"+i])continue;t[i]=n}return t};Inspector.prototype.showProperties=function(e,t){for(var i in t){var n=i;var r=t[i];if(!r)continue;if(r.constructor===String)r={type:r};if(r.name)n=r.name;if(!r.callback){var o={instance:e,name:n,options:r};if(r.type=="function"){}else r.callback=Inspector.assignValue.bind(o)}if(!r.callback_update){var o={instance:e,name:n};r.callback_update=function(){return this.instance[this.name]}.bind(o)}r.instance=e;r.varname=n;var s=r.widget||r.type||"string";if(this.on_addProperty)this.on_addProperty(s,e,n,e[n],r);this.add(s,n,e[n],r)}if(e.constructor.widgets)for(var i in e.constructor.widgets){var a=e.constructor.widgets[i];this.add(a.widget,a.name,a.value,a)}if(e.onShowProperties)e.onShowProperties(this);if(e.constructor.onShowProperties)e.constructor.onShowProperties(e,this)};Inspector.assignValue=function(e){var t=this.instance;var i=t[this.name];if(i==null||e==null||this.options.type=="enum")t[this.name]=e;else if(typeof i=="number")t[this.name]=parseFloat(e);else if(typeof i=="string")t[this.name]=e;else if(e&&e.length&&i&&i.length&&(!Object.getOwnPropertyDescriptor(t,this.name)||!Object.getOwnPropertyDescriptor(t,this.name).set)&&(!Object.getOwnPropertyDescriptor(t.__proto__,this.name)||!Object.getOwnPropertyDescriptor(t.__proto__,this.name).set)){for(var n=0;n<e.length;++n)i[n]=e[n]}else t[this.name]=e};Inspector.prototype.createWidget=function(e,t,i){i=i||{};t=t===undefined||t===null?"":t;var n=document.createElement("DIV");n.className="widget "+(i.className||"");n.inspector=this;n.options=i;n.name=e;this.row_number+=this.widgets_per_row;if(this.row_number%2==0)n.className+=" even";var r=i.width||this.widgets_width;if(r){n.style.width=vjgui.sizeToCSS(r);if(!n.style.width)n.style.width="calc("+vjgui.sizeToCSS(r)+")";n.style.minWidth="auto"}var o=i.height||this.height;if(o){n.style.height=vjgui.sizeToCSS(o);if(!n.style.height)n.style.height="calc("+vjgui.sizeToCSS(o)+")";n.style.minHeight="auto"}this.widgets.push(n);if(i.widget_name||e)this.widgets_by_name[i.widget_name||e]=n;if(this.widgets_per_row!=1){if(!i.width)n.style.width=(100/this.widgets_per_row).toFixed(2)+"%";n.style.display="inline-block"}var s="";var a="";if(e!==undefined&&e!==null&&(this.name_width||i.name_width)&&!this.one_line){var l=vjgui.sizeToCSS(i.name_width||this.name_width);s="style='width: calc("+l+" - 0px); width: -webkit-calc("+l+" - 0px); width: -moz-calc("+l+" - 0px); '";a="style='width: calc( 100% - "+l+"); width: -webkit-calc(100% - "+l+"); width: -moz-calc( 100% - "+l+"); '"}if(i.name_width)s="style='width: "+vjgui.sizeToCSS(i.name_width)+" '";if(i.content_width)a="style='width: "+vjgui.sizeToCSS(i.content_width)+" '";var c="";var u="";var d=this.one_line?"":"<span class='filling'></span>";if(i.pretitle)u=i.pretitle;var h="wcontent ";var f=e;if(i.title)f=i.title;if(e===null||e===undefined)h+=" full";else if(e==="")c+="<span class='wname' title='"+f+"' "+s+">"+u+"</span>";else c+="<span class='wname' title='"+f+"' "+s+">"+u+e+d+"</span>";if(t.constructor===String||t.constructor===Number||t.constructor===Boolean)n.innerHTML=c+"<span class='info_content "+h+"' "+a+">"+t+"</span>";else{n.innerHTML=c+"<span class='info_content "+h+"' "+a+"></span>";var p=n.querySelector("span.info_content");if(p)p.appendChild(t)}n.content=n.querySelector("span.info_content");n.remove=function(){if(this.parentNode)this.parentNode.removeChild(this)};return n};Inspector.onWidgetChange=function(e,t,i,n,r,o){var s=e.section;if(!n.skip_wchange){if(s)vjgui.trigger(s,"wbeforechange",i);vjgui.trigger(e,"wbeforechange",i)}this.values[t]=i;var a=undefined;if(n.callback){if(r)a=n.callback.apply(e,i);else a=n.callback.call(e,i,o)}if(!n.skip_wchange){if(s)vjgui.trigger(s,"wchange",i,e);vjgui.trigger(e,"wchange",i,e)}if(this.onchange)this.onchange(t,i,e);return a};Inspector.widget_constructors={null:"addNull",title:"addTitle",info:"addInfo",default:"addDefault",number:"addNumber",slider:"addSlider",string:"addString",text:"addString",textarea:"addTextarea",color:"addColor",boolean:"addCheckbox",checkbox:"addCheckbox",icon:"addIcon",vec2:"addVector2",vector2:"addVector2",vec3:"addVector3",vector3:"addVector3",vec4:"addVector4",vector4:"addVector4",enum:"addCombo",dropdown:"addCombo",combo:"addCombo",button:"addButton",buttons:"addButtons",file:"addFile",line:"addLine",list:"addList",tree:"addTree",datatree:"addDataTree",pad:"addPad",array:"addArray",separator:"addSeparator"};Inspector.registerWidget=function(e,t){var i="add"+e.charAt(0).toUpperCase()+e.slice(1);Inspector.prototype[i]=t;Inspector.widget_constructors[e]=i};Inspector.prototype.add=function(e,t,i,n){if(!e)throw"Inspector: no type specified";if(arguments.length==1&&typeof e=="object"){n=e;e=n.type;t=n.name;i=n.value}var r=vjgui.Inspector.widget_constructors[e.toLowerCase()];if(!r){console.warn("vjgui.Inspector do not have a widget called",e);return}if(r.constructor===String)r=vjgui.Inspector.prototype[r];if(!r)return;if(r.constructor!==Function)return;if(n&&n.constructor===Function)n={callback:n};return r.call(this,t,i,n)};Inspector.prototype.getValue=function(e){return this.values[e]};Inspector.prototype.applyOptions=function(e,t){if(!e||!t)return;if(t.className)e.className+=" "+t.className;if(t.id)e.id=t.id;if(t.width)e.style.width=vjgui.sizeToCSS(t.width);if(t.height)e.style.height=vjgui.sizeToCSS(t.height)};Inspector.prototype.addSeparator=function(){var e=document.createElement("DIV");e.className="separator";this.append(e);return e};Inspector.prototype.addNull=function(e,t,i){return null};Inspector.prototype.addDefault=function(e,t,i){if(t===null||t===undefined)return null;if(t.constructor===Boolean)return this.addCheckbox(e,t,i);else if(t.constructor===String)return this.addString(e,t,i);else if(t.constructor===Number)return this.addNumber(e,t,i);else if(t.length==4)return this.addVector4(e,t,i);else if(t.length==3)return this.addVector3(e,t,i);else if(t.length==2)return this.addVector2(e,t,i);return null};Inspector.prototype.addString=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this;this.values[e]=t;var r="text";if(i.password)r="password";var o=i.focus?"autofocus":"";var s=this.createWidget(e,"<span class='inputfield full "+(i.disabled?"disabled":"")+"'><input type='"+r+"' tabIndex='"+this.tab_index+"' "+o+" class='text string' value='"+t+"' "+(i.disabled?"disabled":"")+"/></span>",i);var a=s.querySelector(".wcontent input");if(i.placeHolder)a.setAttribute("placeHolder",i.placeHolder);if(i.align=="right"){a.style.direction="rtl"}a.addEventListener(i.immediate?"keyup":"change",function(t){var r=Inspector.onWidgetChange.call(n,s,e,t.target.value,i);if(r!==undefined)this.value=r});if(i.callback_enter)a.addEventListener("keydown",function(t){if(t.keyCode==13){var r=Inspector.onWidgetChange.call(n,s,e,t.target.value,i);i.callback_enter();t.preventDefault()}});this.tab_index+=1;s.setIcon=function(e){if(!e){a.style.background="";a.style.paddingLeft=""}else{a.style.background="transparent url('"+e+"') no-repeat left 4px center";a.style.paddingLeft="1.7em"}};if(i.icon)s.setIcon(i.icon);s.setValue=function(e,t){if(e===undefined)return;if(e===a.value)return;a.value=e;if(!t)vjgui.trigger(a,"change")};s.getValue=function(){return a.value};s.focus=function(){this.querySelector("input").focus()};s.disable=function(){a.disabled=true};s.enable=function(){a.disabled=false};this.append(s,i);this.processElement(s,i);return s};Inspector.prototype.addStringButton=function(e,t,i){i=this.processOptions(i);if(t===undefined)t="";var n=this;this.values[e]=t;var r=this.createWidget(e,"<span class='inputfield button'><input type='text' tabIndex='"+this.tab_index+"' class='text string' value='' "+(i.disabled?"disabled":"")+"/></span><button class='micro'>"+(i.button||"...")+"</button>",i);var o=r.querySelector(".wcontent input");o.value=t;o.addEventListener("change",function(t){var o=Inspector.onWidgetChange.call(n,r,e,t.target.value,i);if(o!==undefined)this.value=o});if(i.disabled)o.setAttribute("disabled","disabled");r.setIcon=function(e){if(!e){o.style.background="";o.style.paddingLeft=""}else{o.style.background="transparent url('"+e+"') no-repeat left 4px center";o.style.paddingLeft="1.7em"}};if(i.icon)r.setIcon(i.icon);var s=r.querySelector(".wcontent button");s.addEventListener("click",function(e){if(i.callback_button)i.callback_button.call(r,o.value,e)});if(i.button_width){s.style.width=vjgui.sizeToCSS(i.button_width);var a=r.querySelector(".inputfield");a.style.width="calc( 100% - "+s.style.width+" - 6px)"}this.tab_index+=1;this.append(r,i);r.setValue=function(e,t){o.value=e;if(!t)vjgui.trigger(o,"change")};r.disable=function(){o.disabled=true;s.disabled=true};r.enable=function(){o.disabled=false;s.disabled=false};r.getValue=function(){return o.value};r.focus=function(){vjgui.focus(o)};this.processElement(r,i);return r};Inspector.prototype.addTextarea=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this;this.values[e]=t;var r=this.createWidget(e,"<span class='inputfield textarea "+(i.disabled?"disabled":"")+"'><textarea tabIndex='"+this.tab_index+"' "+(i.disabled?"disabled":"")+"></textarea></span>",i);this.tab_index++;var o=r.querySelector(".wcontent textarea");o.value=t;o.addEventListener(i.immediate?"keyup":"change",function(t){Inspector.onWidgetChange.call(n,r,e,t.target.value,i,false,t)});if(i.callback_keydown)o.addEventListener("keydown",i.callback_keydown);if(i.height)o.style.height="calc( "+vjgui.sizeToCSS(i.height)+" - 5px )";this.append(r,i);r.setValue=function(e,i){if(e===undefined)return;if(e==o.value)return;t=e;o.value=e;if(!i)vjgui.trigger(o,"change")};r.getValue=function(e){return o.value};r.focus=function(){vjgui.focus(o)};r.disable=function(){o.disabled=true};r.enable=function(){o.disabled=false};this.processElement(r,i);return r};Inspector.prototype.addNumber=function(e,t,i){i=this.processOptions(i);t=t||0;var n=this;this.values[e]=t;var r=this.createWidget(e,"",i);this.append(r,i);i.extraclass="full";i.tab_index=this.tab_index;i.full=true;i.precision=i.precision!==undefined?i.precision:2;i.step=i.step===undefined?i.precision==0?1:.1:i.step;this.tab_index++;var o=null;o=new vjgui.Dragger(t,i);o.root.style.width="calc( 100% - 1px )";r.querySelector(".wcontent").appendChild(o.root);o.root.addEventListener("start_dragging",s.bind(i));r.dragger=o;if(i.disabled)o.input.setAttribute("disabled","disabled");function s(e){if(this.callback_before)this.callback_before.call(r)}var a=r.querySelector("input");a.addEventListener("change",function(t){vjgui.trigger(r,"wbeforechange",t.target.value);n.values[e]=t.target.value;if(i.callback){var o=i.callback.call(r,parseFloat(t.target.value));if(typeof o=="number")this.value=o}vjgui.trigger(r,"wchange",t.target.value);if(n.onchange)n.onchange(e,t.target.value,r)});r.setValue=function(e,t){if(e===undefined)return;e=parseFloat(e);if(i.precision)e=e.toFixed(i.precision);e+=i.units||"";if(a.value==e)return;a.value=e;if(!t)vjgui.trigger(a,"change")};r.setRange=function(e,t){o.setRange(e,t)};r.getValue=function(){return parseFloat(a.value)};r.focus=function(){vjgui.focus(a)};r.disable=function(){a.disabled=true};r.enable=function(){a.disabled=false};this.processElement(r,i);return r};Inspector.prototype.addVector2=function(e,t,i){i=this.processOptions(i);if(!i.step)i.step=.1;t=t||[0,0];var n=this;this.values[e]=t;var r=this.createWidget(e,"",i);i.step=i.step||.1;i.tab_index=this.tab_index;i.full=true;this.tab_index++;var o=r.querySelector(".wcontent");var s=new vjgui.Dragger(t[0],i);s.root.style.marginLeft=0;s.root.style.width="calc( 50% - 1px )";o.appendChild(s.root);i.tab_index=this.tab_index;this.tab_index++;var a=new vjgui.Dragger(t[1],i);a.root.style.width="calc( 50% - 1px )";o.appendChild(a.root);r.draggers=[s,a];vjgui.bind(s.root,"start_dragging",l.bind(i));vjgui.bind(a.root,"start_dragging",l.bind(i));function l(e){if(this.callback_before)this.callback_before(e)}var c=r.querySelectorAll("input");for(var u=0;u<c.length;++u)c[u].addEventListener("change",function(t){var o=[];var s=c;for(var a=0;a<s.length;a++)o.push(parseFloat(s[a].value));vjgui.trigger(r,"wbeforechange",[o]);n.values[e]=o;if(i.callback){var l=i.callback.call(r,o);if(typeof l=="object"&&l.length>=2){for(var a=0;a<s.length;a++)s[a].value=l[a];o=l}}vjgui.trigger(r,"wchange",[o]);if(n.onchange)n.onchange(e,o,r)});this.append(r,i);r.setValue=function(e,t){if(!e)return;if(s.getValue()!=e[0])s.setValue(e[0],true);if(a.getValue()!=e[1])a.setValue(e[1],t)};r.setRange=function(e,t){s.setRange(e,t);a.setRange(e,t)};this.processElement(r,i);return r};Inspector.prototype.addVector3=function(e,t,i){i=this.processOptions(i);if(!i.step)i.step=.1;t=t||[0,0,0];var n=this;this.values[e]=t;var r=this.createWidget(e,"",i);i.step=i.step||.1;i.tab_index=this.tab_index;i.full=true;this.tab_index++;var o=new vjgui.Dragger(t[0],i);o.root.style.marginLeft=0;o.root.style.width="calc( 33% - 1px )";r.querySelector(".wcontent").appendChild(o.root);i.tab_index=this.tab_index;this.tab_index++;var s=new vjgui.Dragger(t[1],i);s.root.style.width="calc( 33% - 1px )";r.querySelector(".wcontent").appendChild(s.root);i.tab_index=this.tab_index;this.tab_index++;var a=new vjgui.Dragger(t[2],i);a.root.style.width="calc( 33% - 1px )";r.querySelector(".wcontent").appendChild(a.root);r.draggers=[o,s,a];o.root.addEventListener("start_dragging",l.bind(i));s.root.addEventListener("start_dragging",l.bind(i));a.root.addEventListener("start_dragging",l.bind(i));function l(e){if(this.callback_before)this.callback_before()}var c=r.querySelectorAll("input");for(var u=0;u<c.length;++u)c[u].addEventListener("change",function(t){var o=[];var s=c;for(var a=0;a<s.length;a++)o.push(parseFloat(s[a].value));vjgui.trigger(r,"wbeforechange",[o]);n.values[e]=o;if(i.callback){var l=i.callback.call(r,o);if(typeof l=="object"&&l.length>=3){for(var a=0;a<s.length;a++)s[a].value=l[a];o=l}}vjgui.trigger(r,"wchange",[o]);if(n.onchange)n.onchange(e,o,r)});this.append(r,i);r.setValue=function(e,t){if(!e)return;o.setValue(e[0],true);s.setValue(e[1],true);a.setValue(e[2],t)};r.setRange=function(e,t){o.setRange(e,t);s.setRange(e,t);a.setRange(e,t)};this.processElement(r,i);return r};Inspector.prototype.addVector4=function(e,t,i){i=this.processOptions(i);if(!i.step)i.step=.1;t=t||[0,0,0];var n=this;this.values[e]=t;var r=this.createWidget(e,"",i);i.step=i.step||.1;i.tab_index=this.tab_index;i.full=true;this.tab_index++;var o=r.draggers=[];for(var s=0;s<4;s++){var a=new vjgui.Dragger(t[s],i);a.root.style.marginLeft=0;a.root.style.width="calc( 25% - 1px )";r.querySelector(".wcontent").appendChild(a.root);i.tab_index=this.tab_index;this.tab_index++;a.root.addEventListener("start_dragging",l.bind(i));o.push(a)}function l(e){if(this.callback_before)this.callback_before()}var c=r.querySelectorAll("input");for(var s=0;s<c.length;++s)c[s].addEventListener("change",function(t){var o=[];var s=c;for(var a=0;a<s.length;a++)o.push(parseFloat(s[a].value));vjgui.trigger(r,"wbeforechange",[o]);n.values[e]=o;if(i.callback){var l=i.callback.call(r,o);if(typeof l=="object"&&l.length>=4){for(var a=0;a<s.length;a++)s[a].value=l[a];o=l}}vjgui.trigger(r,"wchange",[o]);if(n.onchange)n.onchange(e,o,r)});this.append(r,i);r.setValue=function(e,t){if(!e)return;for(var i=0;i<o.length;i++)o[i].setValue(e[i],t)};r.setRange=function(e,t){for(var i in o){o[i].setRange(e,t)}};this.processElement(r,i);return r};Inspector.prototype.addPad=function(e,t,i){i=this.processOptions(i);if(!i.step)i.step=.1;t=t||[0,0];var n=this;this.values[e]=t;var r=this.createWidget(e,"",i);i.step=i.step||.1;i.tab_index=this.tab_index;i.full=true;this.tab_index++;var o=i.minx||i.min||0;var s=i.miny||i.min||0;var a=i.maxx||i.max||1;var l=i.maxy||i.max||1;var c=r.querySelector(".wcontent");var u=document.createElement("div");u.className="vjpad";c.appendChild(u);u.style.width="100%";u.style.height="100px";if(i.background){u.style.backgroundImage="url('"+i.background+"')";u.style.backgroundSize="100%";u.style.backgroundRepeat="no-repeat"}var d=document.createElement("div");d.className="vjpad-handler";u.appendChild(d);i.tab_index=this.tab_index;this.tab_index++;var h=false;u._onMouseEvent=function(t){var c=u.getBoundingClientRect();t.mousex=t.pageX-c.left;t.mousey=t.pageY-c.top;t.preventDefault();t.stopPropagation();if(t.type=="mousedown"){document.body.addEventListener("mousemove",u._onMouseEvent);document.body.addEventListener("mouseup",u._onMouseEvent);h=true}else if(t.type=="mousemove"){var d=t.mousex/c.width;var f=t.mousey/c.height;d=d*(a-o)+o;f=f*(l-s)+o;var p=[d,f];vjgui.trigger(r,"wbeforechange",[p]);r.setValue(p);if(i.callback){var v=i.callback.call(r,p);if(v&&v.length>=2){for(var g=0;g<elems.length;g++)r.setValue(v)}}vjgui.trigger(r,"wchange",[p]);if(n.onchange)n.onchange(e,p,r)}else if(t.type=="mouseup"){h=false;document.body.removeEventListener("mousemove",u._onMouseEvent);document.body.removeEventListener("mouseup",u._onMouseEvent)}return true};u.addEventListener("mousedown",u._onMouseEvent);r.setValue=function(e,t){if(e===undefined)return;var i=u.getBoundingClientRect();var n=(e[0]-o)/(a-o);var r=(e[1]-s)/(l-s);n=Math.max(0,Math.min(n,1));r=Math.max(0,Math.min(r,1));var c=(i.width-10)/i.width*100;var h=(i.height-10)/i.height*100;d.style.left=(n*c).toFixed(1)+"%";d.style.top=(r*h).toFixed(1)+"%"};this.append(r,i);r.setValue(t);this.processElement(r,i);return r};Inspector.prototype.addInfo=function(e,t,i){i=this.processOptions(i);t=t===undefined||t===null?"":t;var n=null;if(e!=null)n=this.createWidget(e,t,i);else{n=document.createElement("div");if(i.className)n.className=i.className;if(t.nodeName!==undefined){n.innerHTML="<span class='winfo'></span>";n.childNodes[0].appendChild(t)}else n.innerHTML="<span class='winfo'>"+t+"</span>"}var r=n.querySelector(".winfo")||n.querySelector(".wcontent");if(i.callback)n.addEventListener("click",i.callback.bind(n));n.setValue=function(e){if(e===undefined)return;if(r)r.innerHTML=e};var o=n.querySelector("span.info_content");if(!o)o=n.querySelector(".winfo");if(i.width){n.style.width=vjgui.sizeToCSS(i.width);n.style.display="inline-block";if(!e)r.style.margin="2px"}if(i.height){o.style.height=vjgui.sizeToCSS(i.height);o.style.overflow="auto"}n.scrollToBottom=function(){o.scrollTop=o.offsetTop};n.add=function(e){o.appendChild(e)};this.append(n,i);this.processElement(n,i);return n};Inspector.prototype.addSlider=function(e,t,i){i=this.processOptions(i);if(i.min===undefined)i.min=0;if(i.max===undefined)i.max=1;if(i.step===undefined)i.step=.01;var n=this;if(t===undefined||t===null)t=0;this.values[e]=t;var r=this.createWidget(e,"<span class='inputfield full'>\t\t\t\t<input tabIndex='"+this.tab_index+"' type='text' class='slider-text fixed vjslider-value' value='' /><span class='slider-container'></span></span>",i);var o=r.querySelector(".slider-container");var s=new vjgui.Slider(t,i);o.appendChild(s.root);var a=false;var l=r.querySelector(".slider-text");l.value=t;l.addEventListener("change",function(o){if(a)return;var l=parseFloat(this.value);t=l;s.setValue(l);Inspector.onWidgetChange.call(n,r,e,l,i)});s.onChange=function(t){l.value=t;Inspector.onWidgetChange.call(n,r,e,t,i)};this.append(r,i);r.setValue=function(e,i){if(e===undefined)return;t=e;s.setValue(e,i)};r.getValue=function(){return t};this.processElement(r,i);return r};Inspector.prototype.addCheckbox=function(e,t,i){i=this.processOptions(i);t=!!t;var n=this;this.values[e]=t;var r=i.label_on||i.label||"on";var o=i.label_off||i.label||"off";var s=t?r:o;var a=this.createWidget(e,"<span class='inputfield'><span tabIndex='"+this.tab_index+"' class='fixed flag checkbox "+(t?"on":"off")+"'>"+s+"</span></span>",i);this.tab_index++;var l=a.querySelector(".wcontent .checkbox");l.addEventListener("keypress",function(e){if(e.keyCode==32)vjgui.trigger(this,"click")});a.addEventListener("click",function(){t=!t;a.querySelector("span.flag").innerHTML=t?r:o;if(t)l.classList.add("on");else l.classList.remove("on");Inspector.onWidgetChange.call(n,a,e,t,i)});a.getValue=function(){return t};a.setValue=function(i,r){if(i===undefined)return;t=i;if(n.values[e]!=i&&!r)vjgui.trigger(l,"click")};this.append(a,i);this.processElement(a,i);return a};Inspector.prototype.addFlags=function(e,t,i){var n={};for(var r in e)n[r]=e[r];if(t)for(var r in t)if(typeof n[r]=="undefined")n[r]=t[r]?true:false;for(var r in n){var o={};for(var s in i)o[s]=i[s];o.callback=function(t){return function(i){e[t]=i}}(r);this.addCheckbox(r,n[r],o)}};Inspector.prototype.addCombo=function(e,t,i){i=this.processOptions(i);var n=this;this.values[e]=t;this.tab_index++;var r=this.createWidget(e,"<span class='inputfield full inputcombo "+(i.disabled?"disabled":"")+"'></span>",i);r.options=i;var o=i.values||[];if(o.constructor===Function)o=i.values();var s="<select tabIndex='"+this.tab_index+"' "+(i.disabled?"disabled":"")+" class='"+(i.disabled?"disabled":"")+"'></select>";r.querySelector("span.inputcombo").innerHTML=s;c(o);var a=false;var l=r.querySelector(".wcontent select");l.addEventListener("change",function(s){var l=s.target.value;t=o[l];if(a)return;Inspector.onWidgetChange.call(n,r,e,t,i)});r.getValue=function(){return t};r.setValue=function(e,i){if(e===undefined)return;t=e;var n=r.querySelector("select");var s=n.querySelectorAll("option");var l=-1;if(o.constructor===Array)l=o.indexOf(e);else{var c=0;for(var u in o){if(o[c]==e){l=c;break}else c++}}if(l==-1)return;a=i;for(var u in s){var d=s[u];if(!d||!d.dataset)continue;if(parseFloat(d.dataset["index"])==l){d.setAttribute("selected",true);n.selectedIndex=l}else d.removeAttribute("selected")}a=false};function c(e,i){if(!e)e=[];o=e;if(i)t=i;var n="";var s=0;for(var a in o){var l=o[a];var c=o.constructor===Array?s:a;var u=o.constructor===Array?l:a;if(l&&l.title)u=l.title;n+="<option value='"+c+"' "+(l==t?" selected":"")+" data-index='"+c+"'>"+u+"</option>";s++}r.querySelector("select").innerHTML=n}r.setOptionValues=c;this.append(r,i);this.processElement(r,i);return r};Inspector.prototype.addComboButtons=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this;this.values[e]=t;var r="";if(i.values)for(var o in i.values)r+="<button class='wcombobutton "+(t==i.values[o]?"selected":"")+"' data-name='options.values[i]'>"+i.values[o]+"</button>";var s=this.createWidget(e,r,i);var a=s.querySelectorAll(".wcontent button");vjgui.bind(a,"click",function(t){var r=t.target.innerHTML;n.values[e]=r;var o=s.querySelectorAll(".selected");for(var a=0;a<o.length;++a)o[a].classList.remove("selected");this.classList.add("selected");Inspector.onWidgetChange.call(n,s,e,r,i)});this.append(s,i);this.processElement(s,i);return s};Inspector.prototype.addTags=function(e,t,i){i=this.processOptions(i);t=t||[];var n=this;this.values[e]=t;var r="<select>";if(i.values)for(var o in i.values)r+="<option>"+i.values[o]+"</option>";r+="</select><div class='wtagscontainer inputfield'></div>";var s=this.createWidget(e,"<span class='inputfield full'>"+r+"</span>",i);s.tags={};for(var o in i.value)l(i.value[o]);var a=s.querySelector(".wcontent select");a.addEventListener("change",function(e){l(e.target.value)});function l(t){if(s.tags[t])return;vjgui.trigger(s,"wbeforechange",s.tags);s.tags[t]=true;var r=document.createElement("div");r.data=t;r.className="wtag";r.innerHTML=t+"<span class='close'>X</span>";r.querySelector(".close").addEventListener("click",function(t){var r=this.parentNode.data;delete s.tags[r];vjgui.remove(this.parentNode);vjgui.trigger(s,"wremoved",r);Inspector.onWidgetChange.call(n,s,e,s.tags,i)});s.querySelector(".wtagscontainer").appendChild(r);n.values[e]=s.tags;if(i.callback)i.callback.call(s,s.tags);vjgui.trigger(s,"wchange",s.tags);vjgui.trigger(s,"wadded",t);if(n.onchange)n.onchange(e,s.tags,s)}this.append(s,i);this.processElement(s,i);return s};Inspector.prototype.addList=function(e,t,i){i=this.processOptions(i);var n=this;var r="";if(i.height)r="style='height: 100%; overflow: auto;'";var o="<ul class='vj-list' "+r+" tabIndex='"+this.tab_index+"'><ul>";this.tab_index++;var s=this.createWidget(e,"<span class='inputfield full "+(i.disabled?"disabled":"")+"' style='height: 100%;'>"+o+"</span>",i);var a=s.querySelector(".info_content");a.style.height="100%";var l=s.querySelector(".vj-list");var c=s.querySelector(".inputfield");c.style.height="100%";c.style.paddingBottom="0.2em";var u=s.querySelectorAll("ul");for(var d=0;d<u.length;++d){var h=u[d];h.addEventListener("focus",function(){document.addEventListener("keydown",f,true)});h.addEventListener("blur",function(){document.removeEventListener("keydown",f,true)})}function f(e){var r=s.querySelector("li.selected");if(!r)return;if(e.keyCode==13){if(!r)return;var o=t[r.dataset["pos"]];if(i.callback_dblclick)i.callback_dblclick.call(n,o)}else if(e.keyCode==40){var a=r.nextSibling;if(a)vjgui.trigger(a,"click");if(r.scrollIntoViewIfNeeded)r.scrollIntoViewIfNeeded({block:"end",behavior:"smooth"})}else if(e.keyCode==38){var l=r.previousSibling;if(l)vjgui.trigger(l,"click");if(r.scrollIntoViewIfNeeded)r.scrollIntoViewIfNeeded({block:"end",behavior:"smooth"})}else return;e.preventDefault();e.stopPropagation();return true}function p(r){if(i.multiselection)this.classList.toggle("selected");else{var o=s.querySelectorAll("li");for(var a=0;a<o.length;++a)o[a].classList.remove("selected");this.classList.add("selected")}var l=t[this.dataset["pos"]];Inspector.onWidgetChange.call(n,s,e,l,i);vjgui.trigger(s,"wadded",l)}function v(e){var r=t[this.dataset["pos"]];if(i.callback_dblclick)i.callback_dblclick.call(n,r)}s.updateItems=function(e,n){n=n||i.selected;var r="";t=e;var o=this.querySelector("ul");o.innerHTML="";if(t)for(var s in t){var a=t[s];var l=g(a,n,s);o.appendChild(l)}vjgui.bind(o.querySelectorAll("li"),"click",p)};function g(e,t,n){var r=n;var o=n;t=!!t;var s=null;var a="";if(e!=null){if(e.constructor===String||e.constructor===Number||e.constructor===Boolean){o=String(e)}else if(e){o=e.content||e.title||e.name||n;s=e.style;if(e.icon)a="<img src='"+e.icon+"' class='icon' /> ";if(e.selected)t=true}}var l=o;l=l.replace(/<(?:.|\n)*?>/gm,"");var c=document.createElement("li");c.classList.add("item-"+vjgui.safeName(r));if(t)c.classList.add("selected");c.dataset["name"]=l;c.dataset["pos"]=r;c.value=e;if(s)c.setAttribute("style",s);c.innerHTML=a+o;c.addEventListener("click",p);if(i.callback_dblclick)c.addEventListener("dblclick",v);return c}s.addItem=function(e,i,n){if(t.constructor!==Array){console.error("cannot add item to list of object, only array");return}t.push(e);var r=this.querySelector("ul");var o=g(e,i);r.appendChild(o)};s.removeItem=function(e){var t=s.querySelectorAll(".wcontent li");for(var i=0;i<t.length;i++){if(t[i].dataset["name"]==e)vjgui.remove(t[i])}};s.updateItems(t,i.selected);this.append(s,i);s.getSelected=function(){var e=[];var t=this.querySelectorAll("ul li.selected");for(var i=0;i<t.length;++i)e.push(t[i].dataset["name"]);return e};s.getByIndex=function(e){var t=this.querySelectorAll("ul li");return t[e]};s.getIndex=s.getByIndex;s.selectIndex=function(e,t){var i=this.querySelectorAll("ul li");for(var n=0;n<i.length;++n){var r=i[n];if(n==e)r.classList.add("selected");else if(!t)r.classList.remove("selected")}return i[e]};s.deselectIndex=function(e){var t=this.querySelectorAll("ul li");var i=t[e];if(i)i.classList.remove("selected");return i};s.scrollToIndex=function(e){var t=this.querySelectorAll("ul li");var i=t[e];if(!i)return;this.scrollTop=i.offsetTop};s.selectAll=function(){var e=this.querySelectorAll("ul li");for(var t=0;t<e.length;++t){var i=e[t];if(i.classList.contains("selected"))continue;vjgui.trigger(i,"click")}};s.deselectAll=function(){var e=this.querySelectorAll("ul li");for(var t=0;t<e.length;++t){var i=e[t];if(!i.classList.contains("selected"))continue;vjgui.trigger(i,"click")}};s.setValue=function(e){if(e===undefined)return;this.updateItems(e)};s.getNumberOfItems=function(){var e=this.querySelectorAll("ul li");return e.length};s.filter=function(e,t){var i=this.querySelectorAll("ul li");var n=false;if(e&&e.constructor===String){var r=e;if(t)r.toLowerCase();n=true;e=function(e){return(t?e:e.toLowerCase()).indexOf(r)!=-1}}for(var o=0;o<i.length;++o){var s=i[o];if(!e){s.style.display="";continue}var a=s.value;if(n&&a!=null&&a.constructor!==String)a=s.innerHTML;if(!e(a,s,s.classList.contains("selected")))s.style.display="none";else s.style.display=""}};s.selectByFilter=function(e){var t=this.querySelectorAll("ul li");for(var i=0;i<t.length;++i){var n=t[i];var r=e(n.value,n,n.classList.contains("selected"));if(r===true)n.classList.add("selected");else if(r===false)n.classList.remove("selected")}};if(i.height)s.scrollTop=0;this.processElement(s,i);return s};Inspector.prototype.addButton=function(e,t,i){i=this.processOptions(i);t=i.button_text||t||"";var n=this;var r="";if(e===null)r="single";if(i.micro)r+=" micro";var o="";if(i.disabled)o="disabled='disabled'";var s=i.title||"";var a=this.createWidget(e,"<button tabIndex='"+this.tab_index+"' "+o+"></button>",i);this.tab_index++;var l=a.querySelector("button");l.setAttribute("title",s);l.className="vjbutton "+r;l.innerHTML=t;l.addEventListener("click",function(r){Inspector.onWidgetChange.call(n,a,e,this.innerHTML,i,false,r);vjgui.trigger(l,"wclick",t)});this.append(a,i);a.wclick=function(e){if(!i.disabled)vjgui.bind(this,"wclick",e)};a.setValue=function(e){if(e===undefined)return;l.innerHTML=e};a.disable=function(){l.disabled=true};a.enable=function(){l.disabled=false};this.processElement(a,i);return a};Inspector.prototype.addButtons=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this;var r="";var o="calc( "+(100/t.length).toFixed(3)+"% - 4px )";var s="width:"+o+"; width: -moz-"+o+"; width: -webkit-"+o+"; margin: 2px;";if(t&&typeof t=="object"){for(var a in t){var l="";if(i.title&&i.title.constructor===Array)l=i.title[a]||"";r+="<button class='vjbutton' title='"+l+"' tabIndex='"+this.tab_index+"' style='"+s+"'>"+t[a]+"</button>";this.tab_index++}}var c=this.createWidget(e,r,i);var u=c.querySelectorAll("button");for(var a=0;a<u.length;++a){var d=u[a];d.addEventListener("click",function(t){Inspector.onWidgetChange.call(n,c,e,this.innerHTML,i,null,t);vjgui.trigger(c,"wclick",this.innerHTML)})}this.append(c,i);this.processElement(c,i);return c};Inspector.prototype.addIcon=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this;var r=i.image;var o=i.width||i.size||20;var s=i.height||i.size||20;var a=this.createWidget(e,"<span class='icon' "+(i.title?"title='"+i.title+"'":"")+" tabIndex='"+this.tab_index+"'></span>",i);this.tab_index++;var l=a.querySelector("span.wcontent");var c=a.querySelector("span.icon");var u=i.x||0;if(i.index)u=i.index*-o;var d=t?s:0;a.style.minWidth=a.style.width=o+"px";a.style.margin="0 2px";a.style.padding="0";l.style.margin="0";l.style.padding="0";c.style.display="inline-block";c.style.cursor="pointer";c.style.width=o+"px";c.style.height=s+"px";c.style.backgroundImage="url('"+r+"')";c.style.backgroundPosition=u+"px "+d+"px";c.addEventListener("mousedown",function(r){r.preventDefault();t=!t;var o=Inspector.onWidgetChange.call(n,a,e,t,i);vjgui.trigger(a,"wclick",t);if(o!==undefined)t=o;var l=t?s:0;c.style.backgroundPosition=u+"px "+l+"px";if(i.toggle===false)setTimeout(function(){c.style.backgroundPosition=u+"px 0px";t=false},200)});this.append(a,i);a.setValue=function(r,o){if(r===undefined)return;t=r;var l=t?s:0;c.style.backgroundPosition=u+"px "+l+"px";if(!o)Inspector.onWidgetChange.call(n,a,e,t,i)};a.getValue=function(){return t};this.processElement(a,i);return a};Inspector.prototype.addColor=function(e,t,i){i=this.processOptions(i);t=t||[0,0,0];var n=this;this.values[e]=t;var r="<input tabIndex='"+this.tab_index+"' id='colorpicker-"+e+"' class='color' value='"+(t[0]+","+t[1]+","+t[2])+"' "+(i.disabled?"disabled":"")+"/>";this.tab_index++;if(i.show_rgb)r+="<span class='rgb-color'>"+Inspector.parseColor(t)+"</span>";var o=this.createWidget(e,r,i);this.append(o,i);var s=o.querySelector("input.color");var a=null;if(window.jscolor){a=new jscolor.color(s);a.pickerFaceColor="#333";a.pickerBorderColor="black";a.pickerInsetColor="#222";a.rgb_intensity=1;if(i.disabled)a.pickerOnfocus=false;if(t.constructor!==String&&t.length&&t.length>2){var l=1;a.fromRGB(t[0]*l,t[1]*l,t[2]*l);a.rgb_intensity=l}s.addEventListener("change",function(e){var t=o.querySelector(".rgb-color");if(t)t.innerHTML=vjgui.Inspector.parseColor(a.rgb)});a.onImmediateChange=function(){var t=[a.rgb[0]*a.rgb_intensity,a.rgb[1]*a.rgb_intensity,a.rgb[2]*a.rgb_intensity];var r=[t.concat(),a.toString()];vjgui.trigger(o,"wbeforechange",r);n.values[e]=t;if(i.callback)i.callback.call(o,t.concat(),"#"+a.toString(),a);vjgui.trigger(o,"wchange",r);if(n.onchange)n.onchange(e,t.concat(),o)};i.step=i.step||.01;i.dragger_class="nano";var c=new vjgui.Dragger(1,i);o.querySelector(".wcontent").appendChild(c.root);c.input.addEventListener("change",function(e){var t=parseFloat(this.value);a.rgb_intensity=t;if(a.onImmediateChange)a.onImmediateChange()});o.setValue=function(e,t){a.fromRGB(e[0],e[1],e[2]);if(!t)vjgui.trigger(c.input,"change")};o.getValue=function(){return t}}else{s.addEventListener("change",function(e){var t=o.querySelector(".rgb-color");if(t)t.innerHTML=vjgui.Inspector.parseColor(a.rgb)})}this.processElement(o,i);return o};Inspector.prototype.addFile=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this;this.values[e]=t;var r=i.accept;var o=this.createWidget(e,"<span class='inputfield full whidden' style='width: calc(100% - 26px)'><span class='filename'></span></span><button class='vjbutton' style='width:20px; margin-left: 2px;'>...</button><input type='file' accept='"+r+"' size='100' class='file' value='"+t+"'/>",i);var s=o.querySelector(".wcontent");s.style.position="relative";var a=o.querySelector(".wcontent input");var l=o.querySelector(".wcontent .filename");if(t)l.innerText=t.name;a.addEventListener("change",function(t){if(!t.target.files.length){l.innerText="";Inspector.onWidgetChange.call(n,o,e,null,i);return}var r=null;var s=t.target.files[0];s.files=t.target.files;if(i.generate_url)s.url=URL.createObjectURL(t.target.files[0]);l.innerText=s.name;if(i.read_file){var a=new FileReader;a.onload=function(t){s.data=t.target.result;Inspector.onWidgetChange.call(n,o,e,s,i)};if(i.read_file=="binary")a.readAsArrayBuffer(s);else if(i.read_file=="data_url")a.readAsDataURL(s);else a.readAsText(s)}else{Inspector.onWidgetChange.call(n,o,e,s,i)}});this.append(o,i);return o};Inspector.prototype.addLine=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this;this.values[e]=t;var r=this.createWidget(e,"<span class='line-editor'></span>",i);r.style.width="100%";var o=new vjgui.LineEditor(t,i);r.querySelector("span.line-editor").appendChild(o);vjgui.bind(o,"change",function(t){vjgui.trigger(r,"wbeforechange",[t.target.value]);if(i.callback)i.callback.call(r,t.target.value);vjgui.trigger(r,"wchange",[t.target.value]);Inspector.onWidgetChange.call(n,r,e,t.target.value,i)});this.append(r,i);return r};Inspector.prototype.addTree=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this.createWidget(e,"<div class='wtree inputfield full'></div>",i);var r=n.querySelector(".wtree");if(i.height){r.style.height=typeof i.height=="number"?i.height+"px":i.height;r.style.overflow="auto"}var o=t;var s=n.tree=new vjgui.Tree(t,i.tree_options);s.onItemSelected=function(e,t){if(i.callback)i.callback.call(n,e,t)};r.appendChild(s.root);n.setValue=function(e){s.updateTree(e)};this.append(n,i);this.processElement(n,i);return n};Inspector.prototype.addDataTree=function(e,t,i){i=this.processOptions(i);t=t||"";var n=this.createWidget(e,"<div class='wtree'></div>",i);var r=n.querySelector(".wtree");var o=t;s(r,t);function s(e,t){for(var i in t){var n=document.createElement("div");n.className="treenode";if(typeof t[i]=="object"){n.innerHTML="<span class='itemname'>"+i+"</span><span class='itemcontent'></span>";s(n.querySelector(".itemcontent"),t[i])}else n.innerHTML="<span class='itemname'>"+i+"</span><span class='itemvalue'>"+t[i]+"</span>";e.appendChild(n)}}this.append(n,i);return n};Inspector.prototype.addArray=function(e,t,i){var n=this;if(!t||t.constructor!==Array){console.error("Inspector: Array widget value must be a valid array");return}i=this.processOptions(i);var r=i.data_type||"string";var o=i.max_items||100;var s=null;this.widgets_per_row=3;this.addInfo(e,null,{name_width:"100%",width:"100% - 160px"});var a=this.addString("length",t.length||"0",{width:100,callback:function(e){var e=parseInt(e);if(t<0)t=0;t.length=e;l.call(s)}});this.addButtons(null,["+","-"],{width:60,callback:function(e){if(e=="+")t.length=t.length+1;else if(t.length>0)t.length=t.length-1;a.setValue(t.length);l.call(s)}});this.widgets_per_row=1;s=this.addContainer(e,i);s.value=t;l.call(s);function l(){var e=this;var t=e.value;var s=Math.min(t.length,o);n.widgets_per_row+=1;e.innerHTML="";for(var a=0;a<s;++a){var l=null;if(t[a]!==undefined)l=t[a];var u=document.createElement("div");u.className="array-row";u.innerHTML="<span class='row-index'>"+a+"</span><span class='row-cell'></span><button style='width: 30px;' class='vjbutton single row-trash'><img src='imgs/mini-icon-trash.png'/></button>";e.appendChild(u);var d=u.querySelector(".row-cell");var h={widget_parent:d,callback:c.bind({value:this.value,index:a})};if(i.data_options)for(var f in i.data_options)h[f]=i.data_options[f];var p=n.add(r,null,l,h)}n.widgets_per_row-=1}function c(e){this.value[this.index]=e;if(i.callback)i.callback.call(s,this.value,this.index)}s.setValue=function(e){this.value=e;l.call(s)};s.getValue=function(){return this.value=v};return s};Inspector.prototype.addContainer=function(e,t){if(e&&e.constructor!==String)console.warn("vjgui.Inspector.addContainer first parameter must be a string with the name");var i=this.startContainer(null,t);this.endContainer();return i};Inspector.prototype.startContainer=function(e,t){t=this.processOptions(t);var i=document.createElement("DIV");i.className="wcontainer";this.applyOptions(i,t);this.row_number=0;this.append(i);this.pushContainer(i);if(t.widgets_per_row)this.widgets_per_row=t.widgets_per_row;if(t.height){i.style.height=vjgui.sizeToCSS(t.height);i.style.overflow="auto"}i.refresh=function(){if(i.on_refresh)i.on_refresh.call(this,i)};return i};Inspector.prototype.endContainer=function(e,t){this.popContainer()};Inspector.prototype.addSection=function(e,t){t=this.processOptions(t);var i=this;if(this.current_section)this.current_section.end();var n=document.createElement("DIV");n.className="wsection";if(!e)n.className+=" notitle";if(t.className)n.className+=" "+t.className;if(t.collapsed)n.className+=" collapsed";if(t.id)n.id=t.id;if(t.instance)n.instance=t.instance;var r="";if(e)r+="<div class='wsectiontitle'>"+(t.no_collapse?"":"<span class='switch-section-button'></span>")+e+"</div>";r+="<div class='wsectioncontent'></div>";n.innerHTML=r;n._last_container_stack=this._current_container_stack.concat();this.root.appendChild(n);this.sections.push(n);n.sectiontitle=n.querySelector(".wsectiontitle");if(e)n.sectiontitle.addEventListener("click",function(e){if(e.target.localName=="button")return;n.classList.toggle("collapsed");var i=n.querySelector(".wsectioncontent");i.style.display=i.style.display==="none"?null:"none";if(t.callback)t.callback.call(n,!n.classList.contains("collapsed"))});if(t.collapsed)n.querySelector(".wsectioncontent").style.display="none";this.setCurrentSection(n);if(t.widgets_per_row)this.widgets_per_row=t.widgets_per_row;n.refresh=function(){if(n.on_refresh)n.on_refresh.call(this,n)};n.end=function(){if(i.current_section!=this)return;i._current_container_stack=this._last_container_stack;i._current_container=null;var e=this.querySelector(".wsectioncontent");if(!e)return;if(i.isContainerInStack(e))i.popContainer(e);i.current_section=null};return n};Inspector.prototype.setCurrentSection=function(e){if(this.current_section==e)return;this.current_section=e;var t=e.parentNode;this.popContainer(t);var i=e.querySelector(".wsectioncontent");this.pushContainer(i)};Inspector.prototype.getCurrentSection=function(){for(var e=this._current_container_stack.length-1;e>=0;--e){var t=this._current_container_stack[e];if(t.classList.contains("wsectioncontent"))return t.parentNode}return null};Inspector.prototype.endCurrentSection=function(){if(this.current_section)this.current_section.end()};Inspector.prototype.beginGroup=function(e,t){t=this.processOptions(t);var i=document.createElement("DIV");i.className="wgroup";e=e||"";i.innerHTML="<div class='wgroupheader "+(t.title?"wtitle":"")+"'><span class='switch-section-button'></span>"+e+"</div>";i.group=true;var n=document.createElement("DIV");n.className="wgroupcontent";if(t.collapsed)n.style.display="none";if(t.height)n.style.height=vjgui.sizeToCSS(t.height);if(t.scrollable)n.style.overflow="auto";i.appendChild(n);var r=t.collapsed||false;var o=i.querySelector(".wgroupheader");if(r)o.classList.add("collapsed");o.addEventListener("click",function(e){var t=i.querySelector(".wgroupcontent").style;t.display=t.display==="none"?"":"none";r=!r;if(r)o.classList.add("collapsed");else o.classList.remove("collapsed");e.preventDefault()});this.append(i,t);this.pushContainer(n);return i};Inspector.prototype.endGroup=function(){do{this.popContainer()}while(this._current_container&&!this._current_container.classList.contains("wgroupcontent"))};Inspector.prototype.addTitle=function(e,t){t=this.processOptions(t);var i=document.createElement("DIV");var n="<span class='wtitle'><span class='text'>"+e+"</span>";if(t.help){n+="<span class='help'><div class='help-content'>"+t.help+"</div></span>"}n+="</span>";i.innerHTML=n;i.setValue=function(e){this.querySelector(".text").innerHTML=e};this.row_number=0;this.append(i,t);return i};Inspector.prototype.scrollTo=function(e){var t=this.root.querySelector("#"+e);if(!t)return;var i=this.root.offsetTop;var n=t.offsetTop-i;this.root.parentNode.parentNode.scrollTop=n};Inspector.prototype.processOptions=function(e){if(typeof e=="function")e={callback:e};return e||{}};Inspector.prototype.processElement=function(e,t){if(t.callback_update&&e.setValue){e.on_update=function(){this.setValue(t.callback_update.call(this),true)}}};Inspector.prototype.updateWidgets=function(){for(var e=0;e<this.widgets.length;++e){var t=this.widgets[e];if(t.on_update)t.on_update(t)}};Inspector.parseColor=function(e){return"<span style='color: #FAA'>"+e[0].toFixed(2)+"</span>,<span style='color: #AFA'>"+e[1].toFixed(2)+"</span>,<span style='color: #AAF'>"+e[2].toFixed(2)+"</span>"};vjgui.Inspector=Inspector;