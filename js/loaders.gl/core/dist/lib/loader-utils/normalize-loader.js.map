{"version":3,"sources":["../../../src/lib/loader-utils/normalize-loader.ts"],"names":["assert","isLoaderObject","loader","Array","isArray","hasExtensions","extensions","normalizeLoader","options","parseTextSync","parseText","text","binary"],"mappings":"AACA,SAAQA,MAAR,QAAqB,0BAArB;AAEA,OAAO,SAASC,cAAT,CAAwBC,MAAxB,EAA+C;AAAA;;AACpD,MAAI,CAACA,MAAL,EAAa;AACX,WAAO,KAAP;AACD;;AAED,MAAIC,KAAK,CAACC,OAAN,CAAcF,MAAd,CAAJ,EAA2B;AACzBA,IAAAA,MAAM,GAAGA,MAAM,CAAC,CAAD,CAAf;AACD;;AAED,QAAMG,aAAa,GAAGF,KAAK,CAACC,OAAN,YAAcF,MAAd,4CAAc,QAAQI,UAAtB,CAAtB;AAWA,SAAOD,aAAP;AACD;AAED,OAAO,SAASE,eAAT,CAAyBL,MAAzB,EAAiD;AAAA;;AAItDF,EAAAA,MAAM,CAACE,MAAD,EAAS,aAAT,CAAN;AACAF,EAAAA,MAAM,CAACC,cAAc,CAACC,MAAD,CAAf,EAAyB,gBAAzB,CAAN;AAKA,MAAIM,OAAJ;;AACA,MAAIL,KAAK,CAACC,OAAN,CAAcF,MAAd,CAAJ,EAA2B;AACzBM,IAAAA,OAAO,GAAGN,MAAM,CAAC,CAAD,CAAhB;AACAA,IAAAA,MAAM,GAAGA,MAAM,CAAC,CAAD,CAAf;AACAA,IAAAA,MAAM,GAAG,EACP,GAAGA,MADI;AAEPM,MAAAA,OAAO,EAAE,EAAC,GAAGN,MAAM,CAACM,OAAX;AAAoB,WAAGA;AAAvB;AAFF,KAAT;AAID;;AAMD,MAAI,YAAAN,MAAM,UAAN,oCAAQO,aAAR,gBAAyBP,MAAzB,qCAAyB,SAAQQ,SAArC,EAAgD;AAC9CR,IAAAA,MAAM,CAACS,IAAP,GAAc,IAAd;AACD;;AAED,MAAI,CAACT,MAAM,CAACS,IAAZ,EAAkB;AAChBT,IAAAA,MAAM,CAACU,MAAP,GAAgB,IAAhB;AACD;;AAED,SAAOV,MAAP;AACD","sourcesContent":["import type {Loader} from '@loaders.gl/loader-utils';\r\nimport {assert} from '@loaders.gl/loader-utils';\r\n\r\nexport function isLoaderObject(loader?: any): boolean {\r\n  if (!loader) {\r\n    return false;\r\n  }\r\n\r\n  if (Array.isArray(loader)) {\r\n    loader = loader[0];\r\n  }\r\n\r\n  const hasExtensions = Array.isArray(loader?.extensions);\r\n\r\n  /* Now handled by types and worker loaders do not have these\r\n  let hasParser =\r\n    loader.parseTextSync ||\r\n    loader.parseSync ||\r\n    loader.parse ||\r\n    loader.parseStream || // TODO Remove, Replace with parseInBatches\r\n    loader.parseInBatches;\r\n  */\r\n\r\n  return hasExtensions;\r\n}\r\n\r\nexport function normalizeLoader(loader: Loader): Loader {\r\n  // This error is fairly easy to trigger by mixing up import statements etc\r\n  // So we make an exception and add a developer error message for this case\r\n  // To help new users from getting stuck here\r\n  assert(loader, 'null loader');\r\n  assert(isLoaderObject(loader), 'invalid loader');\r\n\r\n  // NORMALIZE [LOADER, OPTIONS] => LOADER\r\n\r\n  // If [loader, options], create a new loaders object with options merged in\r\n  let options;\r\n  if (Array.isArray(loader)) {\r\n    options = loader[1];\r\n    loader = loader[0];\r\n    loader = {\r\n      ...loader,\r\n      options: {...loader.options, ...options}\r\n    };\r\n  }\r\n\r\n  // NORMALIZE text and binary flags\r\n  // Ensure at least one of text/binary flags are properly set\r\n\r\n  // @ts-expect-error\r\n  if (loader?.parseTextSync || loader?.parseText) {\r\n    loader.text = true;\r\n  }\r\n\r\n  if (!loader.text) {\r\n    loader.binary = true;\r\n  }\r\n\r\n  return loader;\r\n}\r\n"],"file":"normalize-loader.js"}