{"version":3,"sources":["../../../src/lib/utils/resource-utils.ts"],"names":["isResponse","isBlob","parseMIMEType","parseMIMETypeFromURL","QUERY_STRING_PATTERN","getResourceUrlAndType","resource","url","stripQueryString","contentTypeHeader","headers","get","type","name","getResourceContentLength","size","length","ArrayBuffer","byteLength","isView","replace"],"mappings":"AAAA,SAAQA,UAAR,EAAoBC,MAApB,QAAiC,gCAAjC;AACA,SAAQC,aAAR,EAAuBC,oBAAvB,QAAkD,mBAAlD;AAEA,MAAMC,oBAAoB,GAAG,MAA7B;AAUA,OAAO,SAASC,qBAAT,CAA+BC,QAA/B,EAA2E;AAEhF,MAAIN,UAAU,CAACM,QAAD,CAAd,EAA0B;AACxB,UAAMC,GAAG,GAAGC,gBAAgB,CAACF,QAAQ,CAACC,GAAT,IAAgB,EAAjB,CAA5B;AACA,UAAME,iBAAiB,GAAGH,QAAQ,CAACI,OAAT,CAAiBC,GAAjB,CAAqB,cAArB,KAAwC,EAAlE;AACA,WAAO;AACLJ,MAAAA,GADK;AAELK,MAAAA,IAAI,EAAEV,aAAa,CAACO,iBAAD,CAAb,IAAoCN,oBAAoB,CAACI,GAAD;AAFzD,KAAP;AAID;;AAGD,MAAIN,MAAM,CAACK,QAAD,CAAV,EAAsB;AACpB,WAAO;AAGLC,MAAAA,GAAG,EAAEC,gBAAgB,CAACF,QAAQ,CAACO,IAAT,IAAiB,EAAlB,CAHhB;AAILD,MAAAA,IAAI,EAAEN,QAAQ,CAACM,IAAT,IAAiB;AAJlB,KAAP;AAMD;;AAED,MAAI,OAAON,QAAP,KAAoB,QAAxB,EAAkC;AAChC,WAAO;AAELC,MAAAA,GAAG,EAAEC,gBAAgB,CAACF,QAAD,CAFhB;AAILM,MAAAA,IAAI,EAAET,oBAAoB,CAACG,QAAD;AAJrB,KAAP;AAMD;;AAGD,SAAO;AACLC,IAAAA,GAAG,EAAE,EADA;AAELK,IAAAA,IAAI,EAAE;AAFD,GAAP;AAID;AASD,OAAO,SAASE,wBAAT,CAAkCR,QAAlC,EAAyD;AAC9D,MAAIN,UAAU,CAACM,QAAD,CAAd,EAA0B;AACxB,WAAOA,QAAQ,CAACI,OAAT,CAAiB,gBAAjB,KAAsC,CAAC,CAA9C;AACD;;AACD,MAAIT,MAAM,CAACK,QAAD,CAAV,EAAsB;AACpB,WAAOA,QAAQ,CAACS,IAAhB;AACD;;AACD,MAAI,OAAOT,QAAP,KAAoB,QAAxB,EAAkC;AAEhC,WAAOA,QAAQ,CAACU,MAAhB;AACD;;AACD,MAAIV,QAAQ,YAAYW,WAAxB,EAAqC;AACnC,WAAOX,QAAQ,CAACY,UAAhB;AACD;;AACD,MAAID,WAAW,CAACE,MAAZ,CAAmBb,QAAnB,CAAJ,EAAkC;AAChC,WAAOA,QAAQ,CAACY,UAAhB;AACD;;AACD,SAAO,CAAC,CAAR;AACD;;AAED,SAASV,gBAAT,CAA0BD,GAA1B,EAA+B;AAC7B,SAAOA,GAAG,CAACa,OAAJ,CAAYhB,oBAAZ,EAAkC,EAAlC,CAAP;AACD","sourcesContent":["import {isResponse, isBlob} from '../../javascript-utils/is-type';\r\nimport {parseMIMEType, parseMIMETypeFromURL} from './mime-type-utils';\r\n\r\nconst QUERY_STRING_PATTERN = /\\?.*/;\r\n\r\n/**\r\n * Returns an object with `url` and (MIME) `type` fields\r\n * If it cannot determine url or type, the corresponding value will be an empty string\r\n *\r\n * @param resource Any type, but only Responses, string URLs and data URLs are processed\r\n *\r\n * @todo string parameters are assumed to be URLs\r\n */\r\nexport function getResourceUrlAndType(resource: any): {url: string; type: string} {\r\n  // If resource is a response, it contains the information directly\r\n  if (isResponse(resource)) {\r\n    const url = stripQueryString(resource.url || '');\r\n    const contentTypeHeader = resource.headers.get('content-type') || '';\r\n    return {\r\n      url,\r\n      type: parseMIMEType(contentTypeHeader) || parseMIMETypeFromURL(url)\r\n    };\r\n  }\r\n\r\n  // If the resource is a Blob or a File (subclass of Blob)\r\n  if (isBlob(resource)) {\r\n    return {\r\n      // File objects have a \"name\" property. Blob objects don't have any\r\n      // url (name) information\r\n      url: stripQueryString(resource.name || ''),\r\n      type: resource.type || ''\r\n    };\r\n  }\r\n\r\n  if (typeof resource === 'string') {\r\n    return {\r\n      // TODO this could mess up data URL but it doesn't matter as it is just used for inference\r\n      url: stripQueryString(resource),\r\n      // If a data url\r\n      type: parseMIMETypeFromURL(resource)\r\n    };\r\n  }\r\n\r\n  // Unknown\r\n  return {\r\n    url: '',\r\n    type: ''\r\n  };\r\n}\r\n\r\n/**\r\n  * Returns (approximate) content length for a resource if it can be determined.\r\n  * Returns -1 if content length cannot be determined.\r\n  * @param resource\r\n\r\n  * @note string parameters are NOT assumed to be URLs\r\n  */\r\nexport function getResourceContentLength(resource: any): number {\r\n  if (isResponse(resource)) {\r\n    return resource.headers['content-length'] || -1;\r\n  }\r\n  if (isBlob(resource)) {\r\n    return resource.size;\r\n  }\r\n  if (typeof resource === 'string') {\r\n    // TODO - handle data URL?\r\n    return resource.length;\r\n  }\r\n  if (resource instanceof ArrayBuffer) {\r\n    return resource.byteLength;\r\n  }\r\n  if (ArrayBuffer.isView(resource)) {\r\n    return resource.byteLength;\r\n  }\r\n  return -1;\r\n}\r\n\r\nfunction stripQueryString(url) {\r\n  return url.replace(QUERY_STRING_PATTERN, '');\r\n}\r\n"],"file":"resource-utils.js"}